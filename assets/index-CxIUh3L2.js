import{K as W,u as k,aF as Ee,o as n,r as P,c as G,y as le,aG as re,aH as Me,W as de,L as r,O as s,s as e,a6 as w,m as p,I as L,a9 as j,Q as v,aI as Re,aJ as je,aK as He,x as ce,J as ee,aL as Be,al as Ue,H as N,D as Pe,A as Fe,aM as Je,aN as qe,aO as We,aP as Ze,aQ as Ge}from"./vue-Bh8DP11B.js";import{A as Le,B as xe,C as Ke}from"./vendor-DwTEYUGU.js";import{E as ie,a as ue,b as ae,c as X,d as be,e as D,f as pe,m as Qe,g as Xe,h as et,i as tt,j as ze,t as st,l as ot,k as lt,n as at,o as Ae,p as Ne,q as ye,r as rt,s as nt,u as dt,v as it,w as ut,x as ct,y as pt,z as mt,A as ft,B as vt,C as _t,D as gt,F as xt}from"./element-plus-BcQPGMvH.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))l(f);new MutationObserver(f=>{for(const _ of f)if(_.type==="childList")for(const $ of _.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&l($)}).observe(document,{childList:!0,subtree:!0});function a(f){const _={};return f.integrity&&(_.integrity=f.integrity),f.referrerPolicy&&(_.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?_.credentials="include":f.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function l(f){if(f.ep)return;f.ep=!0;const _=a(f);fetch(f.href,_)}})();const bt={__name:"App",setup(u){return(m,a)=>(n(),W(k(Ee)))}},Te=Le.create({baseURL:"https://superb-tiglon-wizluna1212-8f061ac6.koyeb.app/",timeout:6e4});Te.interceptors.response.use(u=>u.data&&u.data.code===0?u.data:Promise.reject(new Error(u.data.message||"API請求錯誤")),u=>Promise.reject(u));function yt(u){return Te({url:"/login",method:"post",data:u})}function wt(u){return Te({url:"/register",method:"post",data:u})}const te=Le.create({baseURL:"https://superb-tiglon-wizluna1212-8f061ac6.koyeb.app/",timeout:6e4});te.interceptors.request.use(u=>{const a=se().token;return a&&(u.headers.Authorization=`Bearer ${a}`),u},u=>Promise.reject(u));te.interceptors.response.use(u=>u.data&&u.data.code===0?u.data:Promise.reject(new Error(u.data.message||"API請求錯誤")),u=>Promise.reject(u));function ht(){return te({url:"/banners",method:"get"})}function kt(){return te({url:"/menu",method:"get"})}function $t(u){return te({url:"/orders",method:"post",data:u})}function It(u,m){return te({url:`/users/${u}/profile`,method:"put",data:m})}function Vt(){return te({url:"/orders/history",method:"get"})}function Ct(u,m){return te({url:`/users/${u}`,method:"patch",data:m})}function Pt(u){return te({url:"/forgot-password",method:"post",data:u})}function Tt(u){return te({url:"/reset-password",method:"post",data:u})}const Y=(u,m)=>{console.log(u,JSON.parse(JSON.stringify(m)))},De=xe("orderHistory",()=>{const u=P([]),m=se(),a=G(()=>!m.token),l=()=>{const d=JSON.parse(localStorage.getItem("guest-orders")||"[]");u.value=d},f=async()=>{try{if(!m.token)throw new Error("未登入，無法取得歷史訂單");const d=await Vt();u.value=Array.isArray(d.data)?d.data:[]}catch(d){console.error("取得歷史訂單失敗",d),l()}},_=d=>{const S=JSON.parse(JSON.stringify(d));u.value.push(S),m.token||localStorage.setItem("guest-orders",JSON.stringify(u.value))},$=()=>{u.value=[]},x=async()=>{a.value?l():await f()};return le(()=>m.token,async d=>{d?await f():l()},{immediate:!0}),{historyOrders:u,loadGuestOrders:l,fetchHistoryOrders:f,addOrder:_,clearHistory:$,init:x}}),se=xe("user",{state:()=>({token:localStorage.getItem("token")||"",userInfo:{id:null,name:"",email:"",phone:"",birthday:"",createdAt:""}}),getters:{isLoggedIn:u=>!!u.token&&!!u.userInfo.id,userId:u=>u.userInfo.id},actions:{setToken(u){this.token=u,localStorage.setItem("token",u)},setUserInfo(u){this.userInfo=u},logout(){this.token="",this.userInfo={id:null,name:"",email:"",phone:"",birthday:"",createdAt:""},orderData.name="",orderData.phone="",localStorage.removeItem("token"),De().clearHistory()}}}),Dt={class:"center-x"},St={__name:"Login",setup(u,{expose:m}){const a=P(!1),l=P(null),f=re(),_=Me(),$=se(),x=de({email:"",password:""}),d={email:[{required:!0,message:"請輸入信箱",trigger:"blur"},{type:"email",message:"信箱格式錯誤",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:6,message:"密碼至少需 6 碼",trigger:"blur"}]},S=async()=>{var I;try{if(!l.value)return;await l.value.validate();const o=await yt({...x});o.code===0&&($.setUserInfo(o.data.user),$.setToken(o.data.token),Y("登入成功，會員資料：",$.userInfo),Y("登入成功，token：",$.token),Y("登入狀態：",$.isLoggedIn),D.success("登入成功"),a.value=!1,_.path==="/register"&&f.push("/"))}catch(o){if(o.response)switch(o.response.status){case 401:D.error("找不到此帳號");break;case 403:D.error("密碼錯誤");break;default:D.error(((I=o.response.data)==null?void 0:I.message)||"登入失敗")}console.error("登入錯誤：",o)}},c=()=>{a.value=!1,l.value.resetFields()},t=()=>{a.value=!1,f.push("/forgot-password")};return m({open:()=>a.value=!0}),(I,o)=>{const g=ae,V=ue,R=ie,E=X,q=be;return n(),W(q,{modelValue:a.value,"onUpdate:modelValue":o[2]||(o[2]=y=>a.value=y),title:"會員登入","before-close":c,class:"center-xy w-[400px] flex-col"},{default:r(()=>[s(R,{model:x,rules:d,ref_key:"formRef",ref:l},{default:r(()=>[s(V,{label:"信箱",prop:"email"},{default:r(()=>[s(g,{modelValue:x.email,"onUpdate:modelValue":o[0]||(o[0]=y=>x.email=y),placeholder:"請輸入信箱"},null,8,["modelValue"])]),_:1}),s(V,{label:"密碼",prop:"password"},{default:r(()=>[s(g,{modelValue:x.password,"onUpdate:modelValue":o[1]||(o[1]=y=>x.password=y),type:"password",placeholder:"請輸入密碼"},null,8,["modelValue"]),e("div",{class:"text-gray-500 cursor-pointer hover:text-red-600-500",onClick:t}," 忘記密碼 ")]),_:1})]),_:1},8,["model"]),e("div",Dt,[s(E,{onClick:c},{default:r(()=>o[3]||(o[3]=[w("取消")])),_:1,__:[3]}),s(E,{type:"primary",onClick:S},{default:r(()=>o[4]||(o[4]=[w("登入")])),_:1,__:[4]})])]),_:1},8,["modelValue"])}}},Ot={class:"p-2 pt-3 mx-3 border-b border-gray-200 shadow-sm"},qt={class:"flex flex-col md:flex-row md:items-center md:justify-between relative"},Et={class:"hidden xs:center-y"},Mt={class:"flex space-x-3 pr-3"},Ut={key:0,class:"center-y !px-0 !justify-start"},Lt={key:1,class:"mr-3"},zt={class:"flex flex-col space-y-2 items-start px-2"},At={class:"flex justify-center pt-3 w-full"},Nt={class:"w-full px-2"},Yt={key:0,class:"flex justify-start space-x-2"},Rt={key:1,class:"flex justify-start items-center space-x-2"},jt={__name:"Header",setup(u){const m=P(null),a=se(),l=P(!1),f=re(),_=[{label:"產品列表",path:"/product"},{label:"查詢訂單",path:"/history"},{label:"會員",path:"/member"},{label:"關於",path:"/about"}],$=G(()=>a.isLoggedIn?_.filter(c=>c.label!=="註冊"):_),x=()=>{m.value.open()},d=()=>{a.isLoggedIn||x()},S=c=>{l.value=!1,f.push(c)};return(c,t)=>{const I=pe,o=X,g=et,V=Xe,R=tt,E=ze;return n(),p("header",Ot,[e("div",qt,[e("p",{class:"text-lg font-extrabold text-center md:text-left mb-2 md:mb-0",onClick:t[0]||(t[0]=q=>c.$router.push("/"))}," 晨光早餐店 "),s(o,{class:"xs:hidden absolute -right-1 -top-1 hover:bg-orange-100",onClick:t[1]||(t[1]=q=>l.value=!0),circle:""},{default:r(()=>[s(I,null,{default:r(()=>[s(k(Qe))]),_:1})]),_:1}),e("div",Et,[e("nav",Mt,[(n(!0),p(L,null,j($.value,q=>(n(),p(L,{key:q.path},[q.label==="會員"?(n(),p(L,{key:0},[k(a).isLoggedIn?(n(),W(R,{key:0,trigger:"click"},{dropdown:r(()=>[s(V,null,{default:r(()=>[s(g,{onClick:t[2]||(t[2]=y=>c.$router.push("/member"))},{default:r(()=>t[9]||(t[9]=[w("修改會員資料")])),_:1,__:[9]}),s(g,{onClick:t[3]||(t[3]=y=>c.$router.push("/member/change-password"))},{default:r(()=>t[10]||(t[10]=[w("修改密碼")])),_:1,__:[10]})]),_:1})]),default:r(()=>[s(o,{link:"",class:"!h-[32px]"},{default:r(()=>[w(v(q.label),1)]),_:2},1024)]),_:2},1024)):(n(),W(o,{key:1,link:"",class:"!h-[32px]",onClick:d},{default:r(()=>[w(v(q.label),1)]),_:2},1024))],64)):(n(),W(o,{key:1,link:"",onClick:y=>c.$router.push(q.path),class:"!h-[32px]"},{default:r(()=>[w(v(q.label),1)]),_:2},1032,["onClick"]))],64))),128))]),e("div",null,[k(a).isLoggedIn?(n(),p("span",Lt,[w("歡迎 "+v(k(a).userInfo.name)+" ",1),s(o,{onClick:k(a).logout,link:""},{default:r(()=>t[14]||(t[14]=[w("登出")])),_:1,__:[14]},8,["onClick"])])):(n(),p("div",Ut,[s(o,{onClick:t[4]||(t[4]=q=>c.$router.push("/register")),link:""},{default:r(()=>t[11]||(t[11]=[w("註冊")])),_:1,__:[11]}),t[13]||(t[13]=e("span",{class:"text-gray-300"},"/",-1)),s(o,{onClick:x,link:""},{default:r(()=>t[12]||(t[12]=[w("登入")])),_:1,__:[12]})]))])])]),s(St,{ref_key:"loginRef",ref:m},null,512),s(E,{modelValue:l.value,"onUpdate:modelValue":t[8]||(t[8]=q=>l.value=q),direction:"rtl",size:"200px","with-header":!1,class:"md:hidden"},{default:r(()=>[e("nav",zt,[(n(!0),p(L,null,j($.value,q=>(n(),p("div",{key:q.path,class:"w-full"},[q.label==="會員"?(n(),p(L,{key:0},[k(a).isLoggedIn?(n(),W(R,{key:0,trigger:"click"},{dropdown:r(()=>[s(V,null,{default:r(()=>[s(g,{onClick:t[5]||(t[5]=y=>S("/member"))},{default:r(()=>t[15]||(t[15]=[w("修改會員資料")])),_:1,__:[15]}),s(g,{onClick:t[6]||(t[6]=y=>S("/member/change-password"))},{default:r(()=>t[16]||(t[16]=[w("修改密碼")])),_:1,__:[16]})]),_:1})]),default:r(()=>[s(o,{link:"",class:"!h-[32px]"},{default:r(()=>[w(v(q.label),1)]),_:2},1024)]),_:2},1024)):(n(),W(o,{key:1,link:"",class:"!h-[32px]",onClick:d},{default:r(()=>[w(v(q.label),1)]),_:2},1024))],64)):(n(),W(o,{key:1,link:"",onClick:y=>S(q.path),class:"!h-[32px]"},{default:r(()=>[w(v(q.label),1)]),_:2},1032,["onClick"]))]))),128))]),e("div",At,[e("div",Nt,[k(a).isLoggedIn?(n(),p("div",Rt,[e("span",null,"歡迎 "+v(k(a).userInfo.name),1),s(o,{onClick:k(a).logout,link:""},{default:r(()=>t[20]||(t[20]=[w("登出")])),_:1,__:[20]},8,["onClick"])])):(n(),p("div",Yt,[s(o,{onClick:t[7]||(t[7]=q=>c.$router.push("/register")),link:""},{default:r(()=>t[17]||(t[17]=[w("註冊")])),_:1,__:[17]}),t[19]||(t[19]=e("span",{class:"text-gray-300"},"/",-1)),s(o,{onClick:x,link:""},{default:r(()=>t[18]||(t[18]=[w("登入")])),_:1,__:[18]})]))])])]),_:1},8,["modelValue"])])}}},Ht={class:"bg-orange-400 py-5 text-white"},Bt={class:"w-full mx-auto md:h-[260px] px-6"},Ft={class:"mx-auto grid grid-cols-1 md:grid-cols-3 gap-4"},Jt={class:"flex gap-3 items-center"},Wt={href:"https://www.instagram.com/",target:"_blank",rel:"noopener","aria-label":"Instagram"},Zt={href:"https://www.facebook.com/",target:"_blank",rel:"noopener","aria-label":"Facebook"},Gt={__name:"Footer",setup(u){const m=()=>{window.scrollTo({top:0,behavior:"smooth"})};return(a,l)=>{const f=pe;return n(),p("footer",Ht,[e("div",Bt,[e("div",Ft,[l[2]||(l[2]=e("div",null,[e("h2",{class:"font-bold text-2xl pb-2"},"晨光早餐店"),e("div",null,"地址:台灣"),e("div",null,"電話:02-1234-5678"),e("div",null,"Email：breakfast@example.com"),e("div",{class:"pt-1"},"營業時間：每日 06:00 - 15:00")],-1)),e("div",null,[l[1]||(l[1]=e("h2",{class:"font-bold text-2xl pb-2"},"快速連結",-1)),e("div",Jt,[s(k(Re),{class:"w-6 h-6 text-amber-800",onClick:l[0]||(l[0]=_=>a.$router.push("/"))}),e("a",Wt,[s(k(je),{class:"w-6 h-6 text-pink-500"})]),e("a",Zt,[s(k(He),{class:"w-6 h-6 text-blue-600"})])])]),l[3]||(l[3]=e("div",null,[e("h2",{class:"font-bold text-2xl pb-2"},"店鋪位置"),e("div",{class:"w-full h-25 rounded overflow-hidden"},[e("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3621.2891151693194!2d120.80247207521537!3d23.50830888470479!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x346e9a3b87a7b195%3A0x4d403f78057f3721!2z5paw5r2t5ZyL56uL!5e0!3m2!1szh-TW!2stw!4v1716035061319!5m2!1szh-TW!2stw",frameborder:"0",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"})])],-1))]),l[4]||(l[4]=e("div",{class:"text-center pt-3"},"© 2025 晨光早餐店 All rights reserved.此網站為練習作品",-1)),l[5]||(l[5]=e("div",{class:"text-center"},"商品頁圖片來源：Unsplash、pexels",-1)),e("div",{class:"fixed bottom-6 right-3 h-10 w-10 center-xy rounded-full bg-orange-900",onClick:m},[s(f,null,{default:r(()=>[s(k(st))]),_:1})])])])}}},Kt={class:"flex flex-col min-h-screen"},Qt={class:"flex-1"},Xt={__name:"default",setup(u){return(m,a)=>(n(),p("div",Kt,[s(jt),e("main",Qt,[s(k(Ee))]),s(Gt)]))}},es={class:"absolute inset-0 bg-slate-50 z-50 center-xy flex-col text-center"},ts={__name:"LoadingOverlay",setup(u){return(m,a)=>{const l=pe;return n(),p("div",es,[s(l,{class:"animate-spin text-5xl text-orange-400 mb-6"},{default:r(()=>[s(k(ot))]),_:1}),a[0]||(a[0]=e("h2",{class:"text-2xl font-semibold text-orange-400 mb-2"},"正在載入中...",-1)),a[1]||(a[1]=e("p",{class:"text-orange-400 text-lg leading-relaxed px-6"},[w(" 免費伺服器會在閒置時自動休眠，"),e("br"),w(" 請耐心等候 ")],-1))])}}},ss={class:"w-full"},os=["src","alt"],ls={class:"absolute inset-0 z-20 text-white center-xy flex-col space-y-3"},as={class:"text-3xl md:text-5xl font-bold"},rs={class:"text-xl md:text-3xl font-bold"},ns={__name:"Home",setup(u){const m=P(),a=P(!1),l=P(!1),f=P(!0),_=async()=>{try{const $=await ht();$.code===0?m.value=$.data.list:D.error("取得輪播資料失敗")}catch($){console.error("API 請求失敗:",$)}finally{f.value=!1}};return ce(async()=>{await _(),setTimeout(()=>{a.value=!0},100),setTimeout(()=>{l.value=!0},1500)}),($,x)=>{const d=X,S=at,c=lt;return n(),p("div",ss,[s(c,{interval:0,class:"relative h-[60vh] md:h-[600px] xl:h-[700px]"},{default:r(()=>[(n(!0),p(L,null,j(m.value,t=>(n(),W(S,{key:t.id,class:"h-[60vh] md:h-[600px] xl:h-[700px]"},{default:r(()=>[e("img",{src:`/breakfast-frontend/images/${t.image}.jpg`,alt:t.title,loading:"lazy",class:"h-full w-full object-cover"},null,8,os),x[1]||(x[1]=e("div",{class:"absolute inset-0 z-10 bg-black bg-opacity-10"},null,-1)),e("div",ls,[e("div",{class:ee(["center-xy flex-col text-shadow space-y-4 opacity-0 transition-opacity duration-[2000ms]",{"opacity-100":a.value}])},[e("h2",as,v(t.title),1),e("p",rs,v(t.description),1)],2),e("div",{class:ee(["transition duration-700",{"translate-y-6 opacity-0":!l.value,"translate-y-0 opacity-100":l.value}])},[s(d,{href:t.ctaLink||"#",type:"default",class:"!bg-white !text-black !rounded-full !px-6 !py-3 !text-lg !font-semibold !border-none hover:opacity-90 transition duration-300",onClick:x[0]||(x[0]=I=>$.$router.push("/product"))},{default:r(()=>[w(v(t.ctaText),1)]),_:2},1032,["href"])],2)])]),_:2,__:[1]},1024))),128))]),_:1})])}}},ds={class:"max-w-4xl mx-auto p-6"},is={class:"relative"},us=Object.assign({name:"AboutPage"},{__name:"About",setup(u){return(m,a)=>{const l=Ue("H1");return n(),p("div",ds,[e("div",is,[s(l,{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-4 text-2xl text-gray-700 font-semibold whitespace-nowrap text-center"},{default:r(()=>a[0]||(a[0]=[w(" 關於這個專案 ")])),_:1,__:[0]}),a[1]||(a[1]=Be('<div class="border-2 border-gray-200 rounded-lg shadow-lg w-[90%] mx-auto p-8 bg-white hover:border-orange-300 transition-colors duration-300"><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> 專案介紹 </h2><p class="mb-4 text-gray-600 leading-relaxed"> 這是一個早餐店點餐系統作品，使用 Vue 3、Pinia 做狀態管理，Element Plus 作為 UI 框架。 包含會員系統、購物車、多種加料選項及訂單查詢等功能，模擬電商流程。 </p><ul class="list-disc pl-6 space-y-2 text-gray-600"><li>商品管理：支援商品分類、搜尋功能，可自定義加料選項</li><li>購物車系統：可加入商品、編輯數量、選擇加料，即時計算總價</li><li>會員系統：提供註冊、登入、登出功能，支援密碼重設</li><li>訂單查詢：可依照會員或訪客身分顯示各自的訂單</li><li>響應式設計：支援各種裝置尺寸，提供最佳使用體驗</li></ul></section><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> 技術棧 </h2><ul class="list-disc ml-5 text-gray-600"><li>Vue 3 + Composition API</li><li>Pinia 狀態管理</li><li>Element Plus UI 元件</li><li>TailwindCSS</li><li>Axios 請求 API</li><li>JSON Server + Express 模擬後端</li></ul></section><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> 專案動機 </h2><p class="text-gray-600 leading-relaxed"> 非本科背景，轉職學習前端開發，並以 Vue製作前後端分離的電商網站作為實作練習，整合登入驗證、購物車與查詢訂單等功能。 </p></section><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> GitHub 原始碼 </h2><p><a href="https://github.com/wizluna1212/breakfast-frontend.git" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200"> 原始碼連結 </a></p></section></div>',1))])])}}}),we=xe("cart",()=>{const u=P([]),m=P(!1),a=P(null),l=P(!1),f=o=>{const g=o.price*o.quantity,V=o.extras.reduce((R,E)=>R+E.options.reduce((q,y)=>q+y.price*(y.quantity||1),0),0);return g+V*o.quantity},_=G(()=>u.value.reduce((o,g)=>o+f(g),0)),$=G(()=>u.value.reduce((o,g)=>o+g.quantity,0));return{cartItems:u,showCart:m,editingItem:a,showProduct:l,totalPrice:_,cartCount:$,toggleCart:()=>{m.value=!m.value},setEditingItem:o=>{a.value={...o}},clearEditingItem:()=>{a.value=null,l.value=!1},addToCart:(o,g)=>{try{const V=a.value?a.value.cartId:o.cartId,R={cartId:V,cateId:o.cateId,prodId:o.id,name:o.name,price:o.price,quantity:o.quantity||1,extraType:o.extraType,extras:g||[],image:o.image};Y("準備加入的購物車項目:",R);const E=u.value.findIndex(y=>y.prodId===R.prodId&&JSON.stringify(y.extras)===JSON.stringify(R.extras)),q=a.value?u.value.findIndex(y=>y.cartId===V):-1;E!==-1?(u.value[E].quantity+=o.quantity||1,D.success("已合併相同商品"),q!==-1&&u.value.splice(q,1)):q!==-1?(u.value[q]=R,D.success("更新購物車成功")):(u.value.push(R),D.success("加入購物車成功")),Y("當前購物車內容:",u.value)}catch(V){Y("加入購物車錯誤:",V),D.error("加入購物車失敗")}},removeFromCart:o=>{const g=u.value.findIndex(V=>V.cartId===o);g!==-1&&(u.value.splice(g,1),D.success("移除商品成功"))},clearCart:()=>{u.value=[],D.success("清空購物車成功")},getItemTotal:f}}),cs=xe("order",()=>{const u=we(),m=se(),a=de({name:"",phone:"",note:"",pickupType:"",tableNumber:"",takeTime:"",paymentMethod:"cash"}),l=P(null),f=()=>{a.name="",a.phone="",a.note="",a.pickupType="",a.tableNumber="",a.takeTime="",a.paymentMethod="cash"};return{orderData:a,completedOrder:l,generateOrderData:()=>{const x=!!m.token,d={customer:{name:a.name,phone:a.phone},pickupType:a.pickupType,tableNumber:a.tableNumber||"",takeTime:a.takeTime||"",paymentMethod:a.paymentMethod,items:u.cartItems,totalPrice:u.totalPrice,note:a.note||""};return d.tableNumber||delete d.tableNumber,d.note||delete d.note,x&&(d.userId=m.userId),Y("準備送出的訂單數據：",d),d},fetchSendOrder:async x=>{try{const d=await $t(x);if(d.code===0){const S={...x,orderId:d.data.orderId,timestamp:d.data.timestamp};return l.value=S,Y("訂單送出成功，完整訂單數據：",S),u.cartItems=[],f(),l.value}else throw new Error(d.message||"送出訂單失敗")}catch(d){throw console.error("送出訂單錯誤:",d),D.error(d.message||"送出訂單失敗"),d}},resetOrderData:f}}),ps={class:"min-h-screen flex flex-col max-w-5xl mx-auto"},ms={class:"bg-gray-100 w-full center-xy"},fs={class:"flex-grow"},vs={key:0,class:"center-xy flex flex-col"},_s={class:"w-[80%]"},gs={class:"center-xy py-1"},xs={class:"w-1/2 text-lg"},bs={class:"w-1/4 text-center"},ys={class:"w-1/4 text-right pr-2"},ws={key:0},hs={class:"w-1/2 pl-4"},ks={class:"w-1/4 text-center"},$s={class:"w-1/4 text-right pr-2"},Is={class:"center-xy py-2 mt-2"},Vs={class:"text-2xl font-bold text-red-500 ml-2"},Cs={key:0,class:"text-red-500 text-sm mt-1"},Ps={key:1,class:"w-[240px] center-xy mt-4 flex-col"},Ts={key:2},Ds={class:"border !rounded-full w-[300px] h-8 text-center"},Ss={class:"border !rounded-full w-[300px] h-8 text-center"},Os={key:3},qs={key:1,class:"center-x w-full"},Es={class:"w-full sm:w-[80%] flex flex-col p-2"},Ms={class:"font-semibold pr-2"},Us={class:"m-1"},Ls={class:"center-xy py-1"},zs={class:"w-1/2 text-lg"},As={class:"w-1/4 text-center"},Ns={class:"w-1/4 text-right pr-2"},Ys={key:0},Rs={class:"w-1/2 pl-4"},js={class:"w-1/4 text-center"},Hs={class:"w-1/4 text-right pr-2"},Bs={class:"bg-orange-200 rounded w-full text-center h-8 center-xy"},Fs={class:"text-red-500"},Js={key:2,class:"center-x w-full my-8 p-2"},Ws={key:0,class:"space-y-2"},Zs={class:"py-2"},Gs={class:"py-4"},Ks={class:"center-xy"},Qs={key:3,class:"sticky bottom-0 left-0 w-full h-12 mt-4 bg-gray-100 z-10 center-xy"},Xs={key:0},eo={key:1},to={__name:"Checkout",setup(u){const m=P(null),a=we(),l=cs(),f=se(),_=De(),$=re(),x=G(()=>a.cartItems),d=G(()=>a.cartCount),S=G(()=>a.totalPrice),c=l.orderData,t=P(1),I=P(!1),o=P(""),g=P(null),V=P(""),R=P(null),E=P(""),q=P([]),y=P(""),Z=P(""),J=P(""),he=G(()=>[{label:"取餐方式:",value:o.value==="dine-in"?`內用: ${y.value}桌`:o.value==="takeout"?"外帶":""},{label:"取餐時間:",value:Z},{label:"店家地址:",value:"台灣的某個地方"},{label:"店家電話:",value:"02-1234-5678"}]),me=G(()=>{const A=new Date,i=A.getHours(),b=A.getMinutes(),H=i>6||i===6&&b>=0,C=i<15||i===15&&b===0;return H&&C}),T=A=>{if(A==="dine-in"&&!me.value){D.warning("目前不在營業時間內，無法選擇內用");return}o.value=A;const i=new Date,b=new Date(i.getTime()+21*6e4);if(A==="dine-in")J.value=b.toISOString(),Z.value=K(J.value),Y("內用akeTimeISO",J.value),Y("內用takeTimeText",Z.value);else if(A==="takeout"){y.value="";const H=i.getHours(),C=H>=15,F=H<=6,oe=new Intl.DateTimeFormat("sv-SE").format(b),fe=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}).format(b);if(g.value=oe,C)g.value=null,V.value="",J.value="",Z.value="今日已過營業時間，請選擇其它日期";else{F?V.value="06:00":V.value=fe;const ve=`${g.value}T${V.value}:00.000`;J.value=new Date(ve).toISOString(),Z.value=K(J.value),h()}}},U=()=>{I.value&&(R.value=g.value,E.value=V.value),I.value=!I.value},M=A=>{const i=new Date(A),b=new Date,H=new Date;H.setDate(b.getDate()+6);const C=i.toDateString()===b.toDateString(),F=new Date,oe=F.getHours()>15||F.getHours()===15&&F.getMinutes()>0;return i.getTime()<b.setHours(0,0,0,0)||i.getTime()>H.setHours(23,59,59,999)||i.getDay()===0||C&&oe},h=()=>{q.value=[];const A=new Date,b=new Date(g.value).toDateString()===A.toDateString(),H=[];for(let C=6;C<=15;C++)for(let F=0;F<60&&!(C===15&&F>0);F+=10){const oe=`${String(C).padStart(2,"0")}:${String(F).padStart(2,"0")}`;H.push(oe)}if(b){const C=A.getHours()*60+A.getMinutes(),F=6*60,oe=15*60;if(C>=oe&&C<F){q.value=["今日已過營業時間，請選擇其他日期"],V.value=q.value[0];return}const fe=Math.ceil((C+20)/10)*10;q.value=H.filter(ve=>{const[Ve,Ce]=ve.split(":").map(Number);return Ve*60+Ce>=fe})}else q.value=H;V.value=q.value[0]},z=()=>{g.value=R.value,V.value=E.value,I.value=!1},B=()=>{Y("selectedDate:",g.value),Y("selectedTime:",V.value);const A=`${g.value}T${V.value}`;J.value=new Date(A).toISOString(),Y("pickupISO外帶時間:",J.value),Z.value=K(J.value),I.value=!1},K=A=>new Date(String(A)).toLocaleString("zh-TW",{timeZone:"Asia/Taipei",year:"numeric",month:"2-digit",day:"2-digit",weekday:"narrow",hour:"2-digit",minute:"2-digit",hour12:!1}).replaceAll("/","-"),_e={name:[{required:!0,message:"請輸入姓名",trigger:"blur"},{pattern:/^[^\d]+$/,message:"姓名不能包含數字",trigger:"blur"}],phone:[{required:!0,message:"請輸入電話",trigger:"blur"},{max:10,message:"手機號碼最多10個數字",trigger:"blur"},{pattern:/^09\d{8}$/,message:"請輸入正確的手機號碼格式",trigger:"blur"}],paymentMethod:[{required:!0,message:"請選擇付款方式",trigger:"change"}]},ge=()=>{a.showCart=!1,$.push("/product")},ke=()=>{t.value=1},$e=()=>{if(x.value.length===0){D.warning("購物車是空的，請選擇商品");return}if(!o.value){D.warning("請選擇取餐方式");return}if(o.value==="dine-in"&&(!y.value||y.value>11)){D.warning("請輸入桌號");return}if(o.value==="takeout"){if(!g.value||!V.value){D.warning("請選擇自取的取餐時間");return}const[A,i]=V.value.split(":").map(Number);if(!(A>=6&&(A<15||A===15&&i===0))){D.warning("自取時間請選擇 06:00–15:00 間");return}}o.value==="dine-in"?c.tableNumber=y.value:c.tableNumber="",c.takeTime=J.value,c.pickupType=o.value,t.value=2},Ie=async()=>{if(!await m.value.validate().catch(()=>!1)){D.error("請確認表單資料正確");return}const i=!!f.token;try{let b=await l.generateOrderData();if(Y("準備發送的訂單數據：",b),i)await l.fetchSendOrder(b),Y("訂單提交結果：",l.completedOrder),D.success(`訂單成功，訂單編號: ${l.completedOrder.orderId}`);else{const H={...b,orderId:`G-${Date.now()}-${Math.floor(Math.random()*1e3)}`,timestamp:new Date().toISOString()};l.completedOrder=H,D.success(`訂單成功（訪客模式），訂單編號: ${H.orderId}`)}_.addOrder(l.completedOrder),a.cartItems=[],l.resetOrderData(),t.value=3,Y("完成的訂單資訊：",l.completedOrder)}catch(b){console.error("送出訂單錯誤:",b),D.error(b.message||"送出訂單失敗")}};return le(g,()=>{g.value&&h()}),le(()=>t.value,A=>{A===2&&f.isLoggedIn&&(c.name=f.userInfo.name,c.phone=f.userInfo.phone,Pe(()=>{var i;(i=m.value)==null||i.clearValidate()}))}),le(()=>f.isLoggedIn,A=>{A&&t.value===2?(c.name=f.userInfo.name,c.phone=f.userInfo.phone,Pe(()=>{var i;(i=m.value)==null||i.clearValidate()})):A||(c.name="",c.phone="")}),(A,i)=>{const b=X,H=ae,C=ue,F=Ne,oe=Ae,fe=ie,ve=ye,Ve=nt,Ce=rt,Oe=be;return n(),p("div",ps,[e("div",ms,[e("div",{class:ee(["flex flex-col xs:flex-row p-4",t.value===1?"border-b-2 border-orange-300":""])},[e("div",{class:ee(t.value===1?"text-orange-300 font-bold":"text-gray-400")},"Step 1.",2),e("div",{class:ee(t.value===1?"text-black":"text-gray-400")},"取餐方式",2)],2),i[10]||(i[10]=e("div",{class:"text-gray-600"},"➔",-1)),e("div",{class:ee(["flex flex-col xs:flex-row p-4",t.value===2?"border-b-2 border-orange-300":""])},[e("div",{class:ee(t.value===2?"text-orange-300 font-bold":"text-gray-400")},"Step 2.",2),e("div",{class:ee(t.value===2?"text-black":"text-gray-400")},"訂購資訊",2)],2),e("div",{class:ee(["flex flex-col xs:flex-row p-4",t.value===3?"border-b-2 border-orange-300":""])},[e("div",{class:ee(t.value===3?"text-orange-300 font-bold":"text-gray-400")},"Step 3.",2),e("div",{class:ee(t.value===3?"text-black":"text-gray-400")},"訂購完成",2)],2)]),e("div",fs,[t.value===1?(n(),p("div",vs,[i[21]||(i[21]=e("div",{class:"mt-4 p-2 font-semibold text-lg"},"商品明細",-1)),e("div",_s,[i[12]||(i[12]=e("div",{class:"center-x border-b py-1 font-bold bg-gray-100 text-gray-400 text-center"},[e("div",{class:"w-1/2"},"商品名稱"),e("div",{class:"w-1/4"},"數量"),e("div",{class:"w-1/4 text-right pr-2"},"價格")],-1)),(n(!0),p(L,null,j(x.value,O=>(n(),p("div",{key:O.cartId,class:"border-b"},[e("div",gs,[e("div",xs,v(O.name),1),e("div",bs,v(O.quantity),1),e("div",ys,"$"+v(O.price*O.quantity),1)]),O.extras&&O.extras.length>0?(n(),p("div",ws,[(n(!0),p(L,null,j(O.extras,ne=>(n(),p("div",{key:ne.id},[(n(!0),p(L,null,j(ne.options,Q=>(n(),p("div",{key:Q.id,class:"center-xy w-full py-1"},[e("div",hs,v(Q.name)+" ($"+v(Q.price)+")",1),e("div",ks,v(Q.quantity)+"(每份)",1),e("div",$s," $"+v(Q.price*Q.quantity*O.quantity),1)]))),128))]))),128))])):N("",!0)]))),128)),e("div",Is,[i[11]||(i[11]=e("span",{class:"text-lg font-bold"},"小計：",-1)),e("span",Vs,"$"+v(S.value),1)])]),i[22]||(i[22]=e("div",{class:"mt-4 p-2 font-semibold text-lg"},"取餐方式",-1)),e("div",null,[s(b,{class:"!rounded-full",type:o.value==="dine-in"?"primary":"default",onClick:i[0]||(i[0]=O=>T("dine-in")),disabled:!me.value},{default:r(()=>i[13]||(i[13]=[w("內用")])),_:1,__:[13]},8,["type","disabled"]),s(b,{class:"!rounded-full",type:o.value==="takeout"?"primary":"default",onClick:i[1]||(i[1]=O=>T("takeout"))},{default:r(()=>i[14]||(i[14]=[w("自取")])),_:1,__:[14]},8,["type"])]),me.value?N("",!0):(n(),p("div",Cs," 目前不在營業時間內，無法選擇內用 ")),o.value==="dine-in"?(n(),p("div",Ps,[e("div",null,[i[15]||(i[15]=w("桌號：")),s(H,{modelValue:y.value,"onUpdate:modelValue":i[2]||(i[2]=O=>y.value=O),class:"!w-10"},null,8,["modelValue"]),i[16]||(i[16]=w("桌"))]),i[17]||(i[17]=e("div",null,"請確認有座位後再填寫桌號，謝謝",-1))])):N("",!0),o.value==="dine-in"?(n(),p("div",Ts,[i[18]||(i[18]=e("div",{class:"mt-4 p-2 font-semibold text-lg center-xy"},"桌號",-1)),e("div",Ds,v(y.value)+"桌",1),i[19]||(i[19]=e("div",{class:"mt-4 p-2 font-semibold text-lg center-xy"},"取餐時間",-1)),e("div",Ss,v(Z.value),1)])):N("",!0),o.value==="takeout"?(n(),p("div",Os,[i[20]||(i[20]=e("div",{class:"mt-4 p-2 font-semibold text-lg center-xy"},"取餐時間",-1)),e("div",{class:"border !rounded-full w-[300px] h-8 text-center",onClick:U},v(Z.value),1)])):N("",!0)])):N("",!0),t.value===2?(n(),p("div",qs,[e("div",Es,[i[26]||(i[26]=e("div",{class:"center-x text-xl pt-5 font-semibold"},"早餐店",-1)),(n(!0),p(L,null,j(he.value,(O,ne)=>(n(),p("div",{key:ne,class:"border-b w-full p-2"},[e("span",Ms,v(O.label),1),e("span",null,v(O.value),1)]))),128)),e("div",Us,[i[23]||(i[23]=e("div",{class:"center-x border-b py-1 font-bold bg-gray-100 text-gray-400 text-center"},[e("div",{class:"w-1/2"},"商品名稱"),e("div",{class:"w-1/4"},"數量"),e("div",{class:"w-1/4 text-right pr-2"},"價格")],-1)),(n(!0),p(L,null,j(x.value,O=>(n(),p("div",{key:O.cartId,class:"border-b"},[e("div",Ls,[e("div",zs,v(O.name),1),e("div",As,v(O.quantity),1),e("div",Ns,"$"+v(O.price*O.quantity),1)]),O.extras&&O.extras.length>0?(n(),p("div",Ys,[(n(!0),p(L,null,j(O.extras,ne=>(n(),p("div",{key:ne.id},[(n(!0),p(L,null,j(ne.options,Q=>(n(),p("div",{key:Q.id,class:"center-xy w-full py-1"},[e("div",Rs,v(Q.name)+" ($"+v(Q.price)+")",1),e("div",js,v(Q.quantity)+"(每份)",1),e("div",Hs," $"+v(Q.price*Q.quantity*O.quantity),1)]))),128))]))),128))])):N("",!0)]))),128))]),e("div",Bs,[w(" 總共"+v(d.value)+"項/",1),e("span",Fs,"$"+v(S.value),1)]),i[27]||(i[27]=e("div",{class:"center-x text-xl pt-5 font-semibold"},"請輸入訂購資訊",-1)),s(fe,{model:k(c),rules:_e,"label-width":"100px",class:"max-w-md mx-auto",ref_key:"formRef",ref:m},{default:r(()=>[s(C,{label:"訂購人姓名",prop:"name"},{default:r(()=>[s(H,{modelValue:k(c).name,"onUpdate:modelValue":i[3]||(i[3]=O=>k(c).name=O),placeholder:"請輸入姓名"},null,8,["modelValue"])]),_:1}),s(C,{label:"手機號碼",prop:"phone"},{default:r(()=>[s(H,{modelValue:k(c).phone,"onUpdate:modelValue":i[4]||(i[4]=O=>k(c).phone=O),placeholder:"請輸入手機號碼，如0910123456",maxlength:"10"},null,8,["modelValue"])]),_:1}),s(C,{label:"付款方式",prop:"paymentMethod"},{default:r(()=>[s(oe,{modelValue:k(c).paymentMethod,"onUpdate:modelValue":i[5]||(i[5]=O=>k(c).paymentMethod=O)},{default:r(()=>[s(F,{value:"cash"},{default:r(()=>i[24]||(i[24]=[w("現金付款")])),_:1,__:[24]}),s(F,{value:"linPay",disabled:!0},{default:r(()=>i[25]||(i[25]=[w("Line pay(尚未開放)")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),s(C,{label:"訂單備註",prop:"note"},{default:r(()=>[s(H,{modelValue:k(c).note,"onUpdate:modelValue":i[6]||(i[6]=O=>k(c).note=O),type:"textarea",rows:2,placeholder:"有需要可填寫備註"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])])):N("",!0),t.value===3?(n(),p("div",Js,[k(l).completedOrder?(n(),p("div",Ws,[i[28]||(i[28]=e("p",{class:"text-lg font-semibold"},"您的訂單已成功送出！",-1)),e("p",null,"訂單編號："+v(k(l).completedOrder.orderId),1),e("p",null," 取餐方式："+v(k(l).completedOrder.pickupType==="dine-in"?"內用":"外帶"),1),e("p",null,v(k(l).completedOrder.pickupType==="dine-in"?`桌號： ${k(l).completedOrder.tableNumber} `:`請於  ${K(k(l).completedOrder.takeTime)}
            後取餐。`),1),e("p",null," 付款方式："+v(k(l).completedOrder.paymentMethod==="cash"?"現金，取餐時付款":"信用卡"),1),e("p",null,"總金額："+v(k(l).completedOrder.totalPrice)+"元",1),i[29]||(i[29]=e("p",null,"感謝您的訂購！如有需要，請洽現場服務人員或撥打店家電話。",-1))])):N("",!0)])):N("",!0),s(Oe,{modelValue:I.value,"onUpdate:modelValue":i[9]||(i[9]=O=>I.value=O),class:"center-xy w-full xs:w-[70%] max-w-md"},{default:r(()=>[e("div",Zs,[i[30]||(i[30]=e("div",{class:"text-lg"},"選擇日期",-1)),s(ve,{modelValue:g.value,"onUpdate:modelValue":i[7]||(i[7]=O=>g.value=O),type:"date","place-holder":"selectedDate","disabled-date":M,format:"YYYY-MM-DD ( ddd )","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),e("div",Gs,[i[31]||(i[31]=e("div",{class:"text-lg"},"選擇時間",-1)),s(Ce,{modelValue:V.value,"onUpdate:modelValue":i[8]||(i[8]=O=>V.value=O),disabled:!g.value,placeholder:"請先選擇日期"},{default:r(()=>[(n(!0),p(L,null,j(q.value,O=>(n(),W(Ve,{key:O,label:A.formatTime,value:O},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),e("div",Ks,[s(b,{onClick:z},{default:r(()=>i[32]||(i[32]=[w("關閉")])),_:1,__:[32]}),s(b,{type:"primary",onClick:B},{default:r(()=>i[33]||(i[33]=[w("確定")])),_:1,__:[33]})])]),_:1},8,["modelValue"]),t.value!==3?(n(),p("div",Qs,[t.value===1?(n(),p("div",Xs,[s(b,{class:"!rounded-full w-[120px] !text-white !bg-gray-500",onClick:ge},{default:r(()=>i[34]||(i[34]=[w("繼續選購")])),_:1,__:[34]}),s(b,{class:"!rounded-full w-[120px] !text-white !bg-orange-400",onClick:$e},{default:r(()=>i[35]||(i[35]=[w("下一步")])),_:1,__:[35]})])):N("",!0),t.value===2?(n(),p("div",eo,[s(b,{class:"!rounded-full w-[120px] !text-white !bg-gray-500",onClick:ke},{default:r(()=>i[36]||(i[36]=[w("上一步")])),_:1,__:[36]}),s(b,{class:"!rounded-full w-[120px] !text-white !bg-orange-400",onClick:Ie},{default:r(()=>i[37]||(i[37]=[w("送出訂單")])),_:1,__:[37]})])):N("",!0)])):N("",!0)])])}}},so={class:"relative max-x-md mx-auto mt-10 center-x"},oo={class:"border border-gray-300 w-[90%] mx-auto"},lo={class:"flex flex-col gap-2 xs:flex-row xs:items-center xs:gap-3"},ao={class:"border border-gray-300 px-2 text-center min-w-[60px] h-8"},ro={__name:"Register",setup(u){const m=P(null),a=P(""),l=se(),f=re(),_=de({email:"",password:"",confirmPassword:"",name:"",birthday:"",phone:"",captcha:""}),$={email:[{required:!0,message:"請輸入信箱",trigger:"blur"},{type:"email",message:"信箱格式錯誤",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請輸入密碼",trigger:"blur"},{validator:(c,t,I)=>{t!==_.password?I(new Error("密碼不一致")):I()},trigger:"blur"}],name:[{required:!0,message:"請輸入姓名",trigger:"blur"},{pattern:/^[^\d]+$/,message:"姓名不能包含數字",trigger:"blur"}],phone:[{required:!0,message:"請輸入電話",trigger:"blur"},{pattern:/^09\d{2}-\d{6}$/,message:"電話格式長度錯誤",trigger:"blur"}],captcha:[{required:!0,message:"請輸入驗證碼",trigger:"blur"},{pattern:/^\d{4}$/,message:"驗證碼錯誤",trigger:"blur"}]},x=()=>{const c=_.phone.replace(/\D/g,"").slice(0,10);c>4?_.phone=c.slice(0,4)+"-"+c.slice(4):_.phone=c},d=()=>{a.value=Math.floor(1e3+Math.random()*9e3).toString()},S=async()=>{try{if(!m.value)return;if(await m.value.validate(),_.captcha!==a.value){D.error("驗證碼錯誤"),d();return}const c=_.phone.replace(/-/g,""),t=await wt({..._,phone:c,createdAt:Date.now()});t.code===0?(l.setToken(t.data.token),l.setUserInfo(t.data.user),console.log("登入成功",l.userInfo),D.success("註冊成功"),setTimeout(()=>{D.success("登入成功"),f.push("/")},3e3)):(D.error(t.message||"註冊失敗"),d())}catch(c){D.error("請確認所有欄位正確"),console.error("驗證失敗",c),d()}};return ce(()=>{d()}),le(()=>l.isLoggedIn,c=>{c&&f.push("/")},{immediate:!0}),(c,t)=>{const I=ae,o=ue,g=ye,V=X,R=ie;return n(),p("div",so,[t[9]||(t[9]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"會員註冊",-1)),e("div",oo,[s(R,{model:_,rules:$,ref_key:"formRef",ref:m,class:"p-5 w-full max-w-[500px] mx-auto mt-3","label-width":"120px"},{default:r(()=>[s(o,{label:"帳號",prop:"email"},{default:r(()=>[s(I,{modelValue:_.email,"onUpdate:modelValue":t[0]||(t[0]=E=>_.email=E),placeholder:"請輸入email做為您的帳號"},null,8,["modelValue"])]),_:1}),s(o,{label:"密碼",prop:"password"},{default:r(()=>[s(I,{modelValue:_.password,"onUpdate:modelValue":t[1]||(t[1]=E=>_.password=E),type:"password","show-password":"",placeholder:"密碼需8-12位，需有英文大小寫及數字"},null,8,["modelValue"])]),_:1}),s(o,{label:"再次輸入密碼",prop:"confirmPassword"},{default:r(()=>[s(I,{modelValue:_.confirmPassword,"onUpdate:modelValue":t[2]||(t[2]=E=>_.confirmPassword=E),type:"password","show-password":"",placeholder:"請輸入相同的密碼"},null,8,["modelValue"])]),_:1}),s(o,{label:"會員姓名",prop:"name"},{default:r(()=>[s(I,{modelValue:_.name,"onUpdate:modelValue":t[3]||(t[3]=E=>_.name=E),placeholder:"請輸入真實姓名(如:王曉明)"},null,8,["modelValue"])]),_:1}),s(o,{label:"生日",prop:"birthday"},{default:r(()=>[s(g,{modelValue:_.birthday,"onUpdate:modelValue":t[4]||(t[4]=E=>_.birthday=E),type:"date",placeholder:"請選擇生日",format:"YYYY/MM/DD","value-format":"YYYY/MM/DD","disabled-date":E=>E.getTime()>Date.now()},null,8,["modelValue","disabled-date"])]),_:1}),s(o,{label:"手機號碼",prop:"phone"},{default:r(()=>[s(I,{modelValue:_.phone,"onUpdate:modelValue":t[5]||(t[5]=E=>_.phone=E),type:"tel",maxlength:"11",placeholder:"請輸入手機號碼，如0900123456",onBlur:x},null,8,["modelValue"])]),_:1}),s(o,{label:"驗證碼",prop:"captcha"},{default:r(()=>[e("div",lo,[s(I,{modelValue:_.captcha,"onUpdate:modelValue":t[6]||(t[6]=E=>_.captcha=E),placeholder:"請輸入4位數字驗證碼",class:"w-full sm:w-[180px]"},null,8,["modelValue"]),e("div",ao,v(a.value),1),s(V,{onClick:d,link:"",type:"primary"},{default:r(()=>t[7]||(t[7]=[w("重新產生")])),_:1,__:[7]})])]),_:1})]),_:1},8,["model"]),s(V,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:S},{default:r(()=>t[8]||(t[8]=[w("註冊")])),_:1,__:[8]})])])}}},no=(u,m)=>{const a=u.__vccOpts||u;for(const[l,f]of m)a[l]=f;return a},io={class:"sticky top-0 bg-white p-2 pt-0 z-10 border-b"},uo={class:"text-center"},co={class:"center-xy mt-2"},po={class:"overflow-y-auto md:px-4 pt-4",style:{"max-height":"calc(100vh - 160px)"}},mo={key:0,class:"text-center"},fo={key:1,class:"space-y-4"},vo={class:"center-x items-start"},_o={class:"flex-1"},go={class:"font-bold"},xo={class:"text-sm text-gray-500 mt-1"},bo={class:"w-8"},yo={class:"text-red-500 w-10 text-right"},wo={class:"flex flex-col gap-2 items-end"},ho={class:"absolute bottom-0 left-0 right-0 bg-white p-4 border-t z-10"},ko={class:"center-y justify-between mb-4 mx-2"},$o={class:"text-xl font-bold"},Io={class:"flex gap-4"},Vo={__name:"CartDrawer",emits:["edit-item"],setup(u,{emit:m}){const a=we(),l=re(),f=P(window.innerWidth<768),_=m,$=()=>{f.value=window.innerWidth<768},x=S=>{_("edit-item",S),a.showCart=!1},d=()=>{if(a.cartItems.length===0){D.warning("購物車是空的");return}a.showCart=!1,l.push("/checkout")};return ce(()=>{window.addEventListener("resize",$)}),Fe(()=>{window.removeEventListener("resize",$)}),(S,c)=>{const t=pe,I=X,o=ze;return n(),W(o,{modelValue:k(a).showCart,"onUpdate:modelValue":c[1]||(c[1]=g=>k(a).showCart=g),size:f.value?"100%":"40%",direction:"rtl",class:"!p-0 !m-0 overflow-hidden","with-header":!1},{default:r(()=>[e("div",io,[e("div",uo,[c[2]||(c[2]=e("div",{class:"text-lg font-bold"},"購物車",-1)),e("div",co,[e("div",null,"你選擇了 "+v(k(a).cartCount)+" 項商品",1)])])]),e("div",po,[k(a).cartItems.length===0?(n(),p("div",mo,"購物車是空的")):(n(),p("div",fo,[(n(!0),p(L,null,j(k(a).cartItems,g=>(n(),p("div",{key:g.cartId,class:"border-b pb-4"},[e("div",vo,[e("div",_o,[e("div",go,v(g.name),1),e("div",xo,[(n(!0),p(L,null,j(g.extras,(V,R)=>(n(),p("span",{key:V.id},[w(v(V.name)+": ",1),(n(!0),p(L,null,j(V.options,(E,q)=>(n(),p("span",{key:E.id},[w(v(E.name)+" ",1),V.type==="add-on"?(n(),p(L,{key:0},[w(" x"+v(E.quantity)+"（每份都加） ",1)],64)):N("",!0),q<V.options.length-1?(n(),p(L,{key:1},[w(", ")],64)):N("",!0)]))),128)),R<g.extras.length-1?(n(),p(L,{key:0},[w(" | ")],64)):N("",!0)]))),128))])]),e("div",bo,v(g.quantity)+"個",1),e("div",yo,"$"+v(k(a).getItemTotal(g)),1),e("div",wo,[s(I,{circle:"",size:"small",class:"hover:bg-gray-100",onClick:V=>x(g)},{default:r(()=>[s(t,null,{default:r(()=>[s(k(dt))]),_:1})]),_:2},1032,["onClick"]),s(I,{circle:"",size:"small",class:"hover:bg-gray-100",onClick:V=>k(a).removeFromCart(g.cartId)},{default:r(()=>[s(t,null,{default:r(()=>[s(k(it))]),_:1})]),_:2},1032,["onClick"])])])]))),128))]))]),e("div",ho,[e("div",ko,[c[3]||(c[3]=e("div",{class:"text-lg"},"小計",-1)),e("div",$o,"NTD $"+v(k(a).totalPrice),1)]),e("div",Io,[s(I,{type:"info",class:"flex-1",onClick:c[0]||(c[0]=g=>k(a).showCart=!1)},{default:r(()=>c[4]||(c[4]=[w("繼續購物")])),_:1,__:[4]}),s(I,{type:"primary",class:"flex-1",onClick:d},{default:r(()=>c[5]||(c[5]=[w("確認結帳")])),_:1,__:[5]})])])]),_:1},8,["modelValue","size"])}}},Co=no(Vo,[["__scopeId","data-v-922b5852"]]),Po={class:"w-[90%] mx-auto mb-4 lg:w-[80%]"},To={class:"w-full lg:w-[90%] mx-auto min-h-[300px] relative"},Do={key:1,class:"grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 justify-items-center"},So={class:"h-[200px] w-full overflow-hidden"},Oo=["src","alt"],qo={class:"text-xl font-semibold pt-2"},Eo={class:"text-red-500"},Mo=["onClick"],Uo={key:0,class:"text-center text-gray-400 py-10 text-lg"},Lo={key:0,class:"absolute -top-1 -right-0 h-5 w-5 rounded-full bg-red-600 text-white center-xy text-sm"},zo={class:"h-[220px] w-full overflow-hidden bg-gray-100 center-xy"},Ao=["src","alt"],No={class:"text-xl font-bold py-3"},Yo={class:"text-red-800 ml-4 text-lg"},Ro={key:0},jo={class:"flex flex-wrap gap-3"},Ho={class:"py-2"},Bo={key:1},Fo={class:"font-bold"},Jo={key:2},Wo={class:"font-bold"},Zo={class:"center-xy py-3 gap-3 flex-col sm:flex-row"},Go={class:"absolute right-2"},Ko={__name:"Product",setup(u){const m=we(),a=P(0),l=P(""),f=P([]),_=P([]),$=P([]),x=P(!0),d=G(()=>a.value===0?_.value:_.value.filter(T=>T.cateId===a.value)),S=G(()=>l.value?_.value.filter(T=>T.name.toLowerCase().includes(l.value.toLowerCase())):[]),c=G(()=>l.value?S.value:d.value),t=P({name:"",price:0,quantity:1,extraType:[],extras:[]}),I=P([]),o=P([]),g=P([]),V=T=>{var U,M;Y("toggleProductDia 被調用，傳入商品:",T),m.editingItem?(Y("從購物車編輯模式，editingItem:",m.editingItem),t.value={...m.editingItem},Y("設置後的selectedProduct:",t.value),I.value=(U=m.editingItem.extraType)!=null&&U.length?$.value.filter(h=>m.editingItem.extraType.includes(h.id)):[],o.value=m.editingItem.extras||[],g.value=m.editingItem.extras.filter(h=>h.type==="condiments").flatMap(h=>h.options.map(z=>z.name)),Y("編輯模式下的初始化狀態:",{selectedProduct:t.value,hasExtras:I.value,selectedExtra:o.value,selectedCondiments:g.value})):(Y("新增商品模式，product:",T),t.value={...T,quantity:1},I.value=(M=T.extraType)!=null&&M.length?$.value.filter(h=>T.extraType.includes(h.id)):[],o.value=[],g.value=[],Y("新增模式下的初始化狀態:",{selectedProduct:t.value,hasExtras:I.value,selectedExtra:o.value,selectedCondiments:g.value})),I.value.forEach(h=>{var z;if(["single-choice","size","tempture"].includes(h.type)){const B=(z=o.value.find(K=>K.type===h.type))==null?void 0:z.options[0];y.value[h.type]=(B==null?void 0:B.name)||h.options[0].name,B||R(h,h.options[0])}}),Y("設置單選加料後的狀態:",{singleSelected:y.value,selectedExtra:o.value}),m.showProduct=!0},R=(T,U)=>{const M=o.value.findIndex(h=>h.type===T.type);M===-1?o.value.push({id:T.id,name:T.name,type:T.type,options:[{...U,quantity:1}].sort((h,z)=>h.id-z.id)}):o.value[M].options=[{...U,quantity:1}].sort((h,z)=>h.id-z.id),o.value.sort((h,z)=>h.id-z.id),o.value=[...o.value]},E=(T,U)=>{const M=o.value.findIndex(h=>h.id===T.id);if(M===-1)o.value.push({id:T.id,name:T.name,type:T.type,options:[{...U,quantity:1}].sort((h,z)=>h.id-z.id)});else{const h=o.value[M].options,z=h.findIndex(B=>B.id===U.id);z===-1?h.push({...U,quantity:1}):(T.type==="condiments"||h[z].quantity===0)&&(h[z].quantity=1),h.sort((B,K)=>B.id-K.id)}o.value.sort((h,z)=>h.id-z.id),o.value=[...o.value]};le(g,T=>{I.value.filter(M=>M.type==="condiments").forEach(M=>{const h=o.value.findIndex(B=>B.id===M.id),z=M.options.filter(B=>T.includes(B.name)).map(B=>({...B,quantity:1})).sort((B,K)=>B.id-K.id);h===-1?z.length>0&&o.value.push({id:M.id,name:M.name,type:M.type,options:z}):z.length>0?o.value[h].options=z:o.value.splice(h,1)}),o.value.sort((M,h)=>M.id-h.id),o.value=[...o.value]},{deep:!0});const q=T=>{switch(T){case"single-choice":return"麵包選擇";case"size":return"尺寸";case"tempture":return"溫度";default:return"必選"}},y=P({size:"",tempture:"","single-choice":""}),Z=G(()=>{const T=o.value.map(M=>({...M,options:M.options.filter(h=>h.quantity>0)})).filter(M=>M.options.length>0),U={...t.value,extras:T};return m.getItemTotal(U)}),J=()=>{const T={...t.value,cartId:t.value.cartId||crypto.randomUUID(),extraType:t.value.extraType||[]},U=(o.value||[]).map(M=>({...M,options:M.options.filter(h=>h.quantity>0).sort((h,z)=>h.id-z.id)})).filter(M=>M.options.length>0).sort((M,h)=>M.id-h.id);m.addToCart(T,U),m.showProduct=!1,m.clearEditingItem(),t.value={name:"",price:0,quantity:1,extraType:[],extras:[]},o.value=[],g.value=[],I.value=[],y.value={size:"",tempture:"","single-choice":""}};le(o,T=>{Y("選擇的加料更新了:",T)},{deep:!0});const he=T=>{m.setEditingItem(T),V(T)};le(()=>m.showProduct,T=>{T&&m.editingItem&&(Y("商品彈窗打開，初始化編輯商品:",m.editingItem),Pe(()=>{V(m.editingItem)}))});const me=async()=>{try{const T=await kt();T&&T.data&&(f.value=T.data.categories||[],_.value=T.data.products||[],$.value=T.data.extras||[])}catch(T){Y("獲取菜單失敗:",T)}};return ce(async()=>{x.value=!0,await me(),x.value=!1}),le(a,()=>{l.value=""}),(T,U)=>{const M=ct,h=ut,z=pe,B=ae,K=pt,_e=X,ge=mt,ke=Ne,$e=Ae,Ie=vt,A=ft,i=be;return n(),p(L,null,[s(h,{modelValue:a.value,"onUpdate:modelValue":U[0]||(U[0]=b=>a.value=b),class:"px-4"},{default:r(()=>[(n(!0),p(L,null,j(f.value,b=>(n(),W(M,{key:b.id,label:b.name,name:b.id},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),e("div",Po,[s(B,{modelValue:l.value,"onUpdate:modelValue":U[1]||(U[1]=b=>l.value=b),placeholder:"搜尋商品"},{prefix:r(()=>[s(z,null,{default:r(()=>[s(k(Je))]),_:1})]),_:1},8,["modelValue"])]),e("div",To,[x.value?(n(),W(ts,{key:0})):N("",!0),c.value.length>0?(n(),p("div",Do,[(n(!0),p(L,null,j(c.value,b=>(n(),W(K,{key:b.id,class:"h-[300px] w-[260px] mb-5 relative"},{default:r(()=>[e("div",So,[e("img",{src:`/breakfast-frontend/images/${b.image}.jpg`,alt:b.name,loading:"lazy",class:"w-full h-full object-cover object-center"},null,8,Oo)]),e("div",qo,v(b.name),1),e("div",Eo,"$"+v(b.price),1),e("div",{class:"h-8 w-8 rounded-full center-xy bg-slate-200 absolute right-5 bottom-5 cursor-pointer hover:bg-orange-100",onClick:H=>V(b)},[s(z,null,{default:r(()=>[s(k(qe))]),_:1})],8,Mo)]),_:2},1024))),128))])):(n(),p(L,{key:2},[l.value?(n(),p("div",Uo,"查無此商品")):N("",!0)],64))]),e("div",{class:"fixed bottom-[80px] lg:top-[200px] right-3 h-10 w-10 center-xy rounded-full bg-orange-400 text-white border border-white",onClick:U[2]||(U[2]=(...b)=>k(m).toggleCart&&k(m).toggleCart(...b))},[k(m).cartItems.length>0?(n(),p("div",Lo,v(k(m).cartItems.length),1)):N("",!0),s(z,null,{default:r(()=>[s(k(qe))]),_:1})]),s(i,{modelValue:k(m).showProduct,"onUpdate:modelValue":U[5]||(U[5]=b=>k(m).showProduct=b),class:"!w-full md:!w-[80%] lg:!w-[60%]"},{default:r(()=>[s(K,{class:"!h-full overflow-y-auto md:p-2 2xl:px-6"},{default:r(()=>[e("div",zo,[e("img",{src:`/breakfast-frontend/images/${t.value.image}.jpg`,alt:t.value.name,loading:"lazy",class:"max-w-full max-h-full object-contain"},null,8,Ao)]),e("div",No,[w(v(t.value.name)+" ",1),e("span",Yo,"$"+v(t.value.price),1)]),(n(!0),p(L,null,j(I.value,b=>{var H;return n(),p("div",{key:b.id},[b.type==="add-on"?(n(),p("div",Ro,[e("div",jo,[(n(!0),p(L,null,j(b.options,C=>(n(),W(_e,{key:C.id,onClick:F=>E(b,C),class:"!w-[120px] !m-0"},{default:r(()=>[e("div",null,v(C.name),1),e("div",null,"$"+v(C.price),1)]),_:2},1032,["onClick"]))),128))]),e("div",Ho,[U[6]||(U[6]=e("div",{class:"font-bold"},"加料區",-1)),(n(!0),p(L,null,j(((H=o.value.find(C=>C.id===b.id))==null?void 0:H.options)||[],C=>(n(),p("div",{key:C.id,class:"center-y gap-2 py-1"},[C.quantity>0?(n(),p(L,{key:0},[s(ge,{modelValue:C.quantity,"onUpdate:modelValue":F=>C.quantity=F,min:0,max:3,class:"h-5 w-[140px] sm:w-[160px]"},null,8,["modelValue","onUpdate:modelValue"]),e("div",null,v(C.name),1),e("div",null,"共$"+v(C.price*C.quantity),1)],64)):N("",!0)]))),128))])])):N("",!0),["single-choice","size","tempture"].includes(b.type)?(n(),p("div",Bo,[e("div",Fo,v(q(b.type)),1),s($e,{modelValue:y.value[b.type],"onUpdate:modelValue":C=>y.value[b.type]=C},{default:r(()=>[(n(!0),p(L,null,j(b.options,C=>(n(),W(ke,{key:C.id,value:C.name,onClick:F=>R(b,C)},{default:r(()=>[w(v(C.name)+" +$"+v(C.price),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):N("",!0),b.type==="condiments"?(n(),p("div",Jo,[e("div",Wo,v(b.name),1),s(A,{modelValue:g.value,"onUpdate:modelValue":U[3]||(U[3]=C=>g.value=C)},{default:r(()=>[(n(!0),p(L,null,j(b.options,C=>(n(),W(Ie,{key:C.id,label:C.name,onClick:F=>E(b,C)},{default:r(()=>[w(v(C.name),1)]),_:2},1032,["label","onClick"]))),128))]),_:2},1032,["modelValue"])])):N("",!0)])}),128)),e("div",Zo,[t.value.quantity?(n(),W(ge,{key:0,modelValue:t.value.quantity,"onUpdate:modelValue":U[4]||(U[4]=b=>t.value.quantity=b),min:1,class:"w-[150px]"},null,8,["modelValue"])):N("",!0),s(_e,{class:"w-[230px] sm:flex-1 rounded-md text-white text-lg font-semibold relative",type:"primary",onClick:J},{default:r(()=>[U[7]||(U[7]=w("加入購物車 ")),e("span",Go,"+$"+v(Z.value),1)]),_:1,__:[7]})])]),_:1})]),_:1},8,["modelValue"]),s(Co,{onEditItem:he})],64)}}},Qo={class:"p-5 px-10 max-w-7xl mx-auto"},Xo={class:"flex flex-col md:flex-row gap-5 mb-6"},el={class:"mt-6 center-xy"},tl={class:"mx-auto w-full text-center"},sl={key:0,class:"p-3 md:p-5"},ol={class:"flex items-center mb-4"},ll={class:"flex items-center mb-4"},al={class:"flex items-center mb-4"},rl={class:"flex items-center mb-4"},nl={class:"flex items-center mb-4"},dl={key:0,class:"flex items-center mb-4"},il={key:1,class:"flex items-center mb-4"},ul={class:"flex items-center mb-4"},cl={class:"flex items-center mb-4"},pl={class:"mt-6"},ml={class:"center-xy py-1"},fl={class:"w-1/2 text-lg"},vl={class:"w-1/4 text-center"},_l={class:"w-1/4 text-right pr-2"},gl={key:0},xl={class:"w-1/2 pl-4"},bl={class:"w-1/4 text-center"},yl={class:"w-1/4 text-right pr-2"},wl={class:"mt-6 text-right"},hl={class:"text-xl text-red-500 font-bold ml-2"},kl={__name:"History",setup(u){const m=De(),a=P(""),l=P([]),f=P(!1),_=P(null),$=c=>c?new Date(c).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",x=G(()=>{let c=m.historyOrders;if(a.value&&(c=c.filter(t=>t.orderId.toLowerCase().includes(a.value.toLowerCase()))),l.value&&l.value.length===2){const[t,I]=l.value;c=c.filter(o=>{const g=new Date(o.timestamp);return g>=new Date(t)&&g<=new Date(I+" 23:59:59")})}return c}),d=c=>{console.log("訂單詳情:",{orderId:c.orderId,pickupType:c.pickupType,takeTime:c.takeTime,timestamp:c.timestamp}),_.value=c,f.value=!0},S=()=>{};return ce(async()=>{await m.init()}),(c,t)=>{const I=pe,o=ae,g=ye,V=xt,R=X,E=_t,q=be;return n(),p("div",Qo,[t[16]||(t[16]=e("h2",{class:"text-2xl font-bold mb-6"},"訂單歷史記錄",-1)),e("div",Xo,[s(o,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=y=>a.value=y),placeholder:"請輸入訂單編號",class:"!w-full md:!w-[250px]",clearable:"",onClear:S},{prefix:r(()=>[s(I,null,{default:r(()=>[s(k(gt))]),_:1})]),_:1},8,["modelValue"]),s(g,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=y=>l.value=y),type:"daterange","range-separator":"至","start-placeholder":"開始日期","end-placeholder":"結束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"!w-full md:!w-[200px]",onChange:c.search},null,8,["modelValue","onChange"])]),e("div",el,[e("div",tl,[s(E,{data:x.value,style:{width:"100%"}},{default:r(()=>[s(V,{prop:"orderId",label:"訂單編號",width:"200"}),s(V,{prop:"timestamp",label:"訂單產生時間",width:"230"},{default:r(({row:y})=>[w(v($(y.timestamp)),1)]),_:1}),s(V,{prop:"pickupType",label:"取餐方式",width:"120"},{default:r(({row:y})=>[w(v(y.pickupType==="dine-in"?"內用":"外帶"),1)]),_:1}),s(V,{prop:"totalPrice",label:"總金額",width:"80"},{default:r(({row:y})=>[w(" $"+v(y.totalPrice),1)]),_:1}),s(V,{prop:"takeTime",label:"取餐時間",width:"180"},{default:r(({row:y})=>[w(v($(y.takeTime)),1)]),_:1}),s(V,{label:"訂單詳細",fixed:"right",class:"w-[110px]"},{default:r(({row:y})=>[s(R,{type:"primary",link:"",onClick:Z=>d(y)},{default:r(()=>t[3]||(t[3]=[w(" 查看詳情 ")])),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),s(q,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=y=>f.value=y),title:"訂單詳情",class:"!w-full max-w-xl"},{default:r(()=>[_.value?(n(),p("div",sl,[e("div",ol,[t[4]||(t[4]=e("span",{class:"font-bold w-24"},"訂單編號：",-1)),e("span",null,v(_.value.orderId),1)]),e("div",ll,[t[5]||(t[5]=e("span",{class:"font-bold w-24"},"訂單產生時間：",-1)),e("span",null,v($(_.value.timestamp)),1)]),e("div",al,[t[6]||(t[6]=e("span",{class:"font-bold w-24"},"訂購人：",-1)),e("span",null,v(_.value.customer.name),1)]),e("div",rl,[t[7]||(t[7]=e("span",{class:"font-bold w-24"},"電話：",-1)),e("span",null,v(_.value.customer.phone),1)]),e("div",nl,[t[8]||(t[8]=e("span",{class:"font-bold w-24"},"取餐方式：",-1)),e("span",null,v(_.value.pickupType==="dine-in"?"內用":"外帶"),1)]),_.value.pickupType==="dine-in"?(n(),p("div",dl,[t[9]||(t[9]=e("span",{class:"font-bold w-24"},"桌號：",-1)),e("span",null,v(_.value.tableNumber),1)])):N("",!0),_.value.pickupType==="takeout"?(n(),p("div",il,[t[10]||(t[10]=e("span",{class:"font-bold w-24"},"取餐時間：",-1)),e("span",null,v(_.value.takeTime?$(_.value.takeTime):"未設定"),1)])):N("",!0),e("div",ul,[t[11]||(t[11]=e("span",{class:"font-bold w-24"},"付款方式：",-1)),e("span",null,v(_.value.paymentMethod==="cash"?"現金":"信用卡"),1)]),e("div",cl,[t[12]||(t[12]=e("span",{class:"font-bold w-24"},"備註：",-1)),e("span",null,v(_.value.note||"無"),1)]),e("div",pl,[t[13]||(t[13]=e("h4",{class:"text-lg font-bold mb-4"},"訂購項目",-1)),t[14]||(t[14]=e("div",{class:"center-x border-b py-1 font-bold bg-gray-100 text-gray-400 text-center"},[e("div",{class:"w-1/2"},"商品名稱"),e("div",{class:"w-1/4"},"數量"),e("div",{class:"w-1/4 text-right pr-2"},"價格")],-1)),(n(!0),p(L,null,j(_.value.items,y=>(n(),p("div",{key:y.cartId,class:"border-b"},[e("div",ml,[e("div",fl,v(y.name),1),e("div",vl,v(y.quantity),1),e("div",_l,"$"+v(y.price*y.quantity),1)]),y.extras&&y.extras.length>0?(n(),p("div",gl,[(n(!0),p(L,null,j(y.extras,Z=>(n(),p("div",{key:Z.id},[(n(!0),p(L,null,j(Z.options,J=>(n(),p("div",{key:J.id,class:"center-xy w-full py-1"},[e("div",xl,v(J.name)+" ($"+v(J.price)+")",1),e("div",bl,v(J.quantity)+"(每份都加)",1),e("div",yl," $"+v(J.price*J.quantity*y.quantity),1)]))),128))]))),128))])):N("",!0)]))),128))]),e("div",wl,[t[15]||(t[15]=e("span",{class:"font-bold"},"總金額：",-1)),e("span",hl,"$"+v(_.value.totalPrice),1)])])):N("",!0)]),_:1},8,["modelValue"])])}}},$l={class:"mx-auto mt-10"},Il=Object.assign({name:"MemberView"},{__name:"Member",setup(u){return(m,a)=>{const l=Ue("router-view");return n(),p("div",$l,[s(l)])}}}),Vl={class:"relative"},Cl={class:"border border-gray-300 w-[90%] mx-auto"},Pl={class:"text-gray-700"},Tl={key:0,class:"text-gray-700"},Dl=Object.assign({name:"MemberProfileView"},{__name:"MemberProfile",setup(u){const m=P(null),a=se(),l=de({name:"",phone:"",birthday:""}),f={phone:[{required:!0,message:"請輸入電話",trigger:"blur"},{pattern:/^09\d{2}-\d{6}$/,message:"電話格式錯誤",trigger:"blur"}]},_=()=>{const x=l.phone.replace(/\D/g,"").slice(0,10);x.length>4?l.phone=x.slice(0,4)+"-"+x.slice(4):l.phone=x},$=async()=>{var x;try{if(!m.value)return;await m.value.validate();const d=await It(a.userId,{phone:l.phone.replace(/-/g,""),birthday:l.birthday||null});d.code===0?(D.success("會員資料修改成功"),a.setUserInfo({...a.userInfo,phone:l.phone,birthday:l.birthday})):D.error(d.message||"會員資料修改失敗")}catch(d){if(d.response)switch(d.response.status){case 403:D.error("無權限修改");break;case 404:D.error("找不到用戶");break;default:D.error(((x=d.response.data)==null?void 0:x.message)||"會員資料修改失敗")}else D.error("請確認所有欄位正確");console.error("驗證失敗",d)}};return ce(()=>{l.name=a.userInfo.name,l.phone=a.userInfo.phone,l.birthday=a.userInfo.birthday}),(x,d)=>{const S=ue,c=ae,t=ye,I=ie,o=X;return n(),p("div",Vl,[d[3]||(d[3]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"修改會員資料",-1)),e("div",Cl,[s(I,{model:l,rules:f,ref_key:"formRef",ref:m,class:"p-5 w-full max-w-md mx-auto mt-3","label-width":"100px"},{default:r(()=>[s(S,{label:"姓名",class:"mx-auto max-w-xs"},{default:r(()=>[e("span",Pl,v(l.name),1)]),_:1}),s(S,{label:"手機",prop:"phone",class:"mx-auto max-w-xs"},{default:r(()=>[s(c,{modelValue:l.phone,"onUpdate:modelValue":d[0]||(d[0]=g=>l.phone=g),placeholder:"請輸入手機號碼",onBlur:_,maxlength:"11",class:"w-[150px]"},null,8,["modelValue"])]),_:1}),s(S,{label:"生日",prop:"birthday",class:"mx-auto max-w-xs"},{default:r(()=>[l.birthday?(n(),p("span",Tl,v(l.birthday),1)):(n(),W(t,{key:1,modelValue:l.birthday,"onUpdate:modelValue":d[1]||(d[1]=g=>l.birthday=g),type:"date",placeholder:"請選擇生日",format:"YYYY/MM/DD","value-format":"YYYY/MM/DD","disabled-date":g=>g.getTime()>Date.now()},null,8,["modelValue","disabled-date"]))]),_:1})]),_:1},8,["model"]),s(o,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:$},{default:r(()=>d[2]||(d[2]=[w("確認修改")])),_:1,__:[2]})])])}}}),Sl={class:"relative"},Ol={class:"border border-gray-300 w-[90%] mx-auto"},ql=Object.assign({name:"ChangePasswordView"},{__name:"ChangePassword",setup(u){const m=P(null),a=se(),l=re(),f=de({oldPassword:"",newPassword:"",confirmPassword:""}),_={oldPassword:[{required:!0,message:"請輸入舊密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請輸入確認密碼",trigger:"blur"},{validator:(x,d,S)=>{d!==f.newPassword?S(new Error("密碼不一致")):S()},trigger:"blur"}]},$=async()=>{var x;try{if(!m.value)return;await m.value.validate();const d=await Ct(a.userId,{oldPassword:f.oldPassword,newPassword:f.newPassword});d.code===0?(D.success("密碼修改成功"),l.push("/"),f.oldPassword="",f.newPassword="",f.confirmPassword=""):D.error(d.message||"密碼修改失敗")}catch(d){if(d.response)switch(d.response.status){case 403:D.error("無權限修改");break;case 404:D.error("找不到用戶");break;case 405:D.error("舊密碼錯誤");break;default:D.error(((x=d.response.data)==null?void 0:x.message)||"密碼修改失敗")}else D.error("請確認所有欄位正確");console.error("驗證失敗",d)}};return(x,d)=>{const S=ae,c=ue,t=ie,I=X;return n(),p("div",Sl,[d[4]||(d[4]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"修改密碼",-1)),e("div",Ol,[s(t,{model:f,rules:_,ref_key:"formRef",ref:m,class:"p-5 w-full max-w-xl mx-auto mt-3 space-y-8","label-width":"100px","label-position":"left"},{default:r(()=>[s(c,{label:"舊密碼",prop:"oldPassword"},{default:r(()=>[s(S,{modelValue:f.oldPassword,"onUpdate:modelValue":d[0]||(d[0]=o=>f.oldPassword=o),type:"password","show-password":"",placeholder:"請輸入舊密碼",class:"w-full max-w-[400px]"},null,8,["modelValue"])]),_:1}),s(c,{label:"新密碼",prop:"newPassword"},{default:r(()=>[s(S,{modelValue:f.newPassword,"onUpdate:modelValue":d[1]||(d[1]=o=>f.newPassword=o),type:"password","show-password":"",placeholder:"密碼需8-12位，需有英文大小寫及數字",class:"w-full max-w-[400px]"},null,8,["modelValue"])]),_:1}),s(c,{label:"確認新密碼",prop:"confirmPassword"},{default:r(()=>[s(S,{modelValue:f.confirmPassword,"onUpdate:modelValue":d[2]||(d[2]=o=>f.confirmPassword=o),type:"password","show-password":"",placeholder:"請輸入相同的新密碼",class:"w-full max-w-[400px]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(I,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:$},{default:r(()=>d[3]||(d[3]=[w("確認修改")])),_:1,__:[3]})])])}}}),El={class:"relative max-x-md mx-auto mt-10 center-x"},Ml={class:"border border-gray-300 w-[90%] mx-auto"},Ul={__name:"ForgotPassword",setup(u){const m=P(null),a=re(),l=de({email:""}),f={email:[{required:!0,message:"請輸入信箱",trigger:"blur"},{type:"email",message:"信箱格式錯誤",trigger:"blur"}]},_=async()=>{await m.value.validate();const $=await Pt({email:l.email}),x=$.token;$.code===0?(D.success("重設密碼連結已寄出，請至信箱查收（模擬）"),setTimeout(()=>{a.push(`/reset-password?token=${x}`)},2e3)):D.error($.data.message||"發送失敗")};return($,x)=>{const d=ae,S=ue,c=ie,t=X;return n(),p("div",El,[x[2]||(x[2]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"忘記密碼",-1)),e("div",Ml,[s(c,{model:l,rules:f,ref_key:"formRef",ref:m,class:"p-5 w-full max-w-[500px] mx-auto mt-3","label-width":"70px","label-position":"left"},{default:r(()=>[s(S,{label:"信箱",prop:"email",class:"mx-auto max-w-xs"},{default:r(()=>[s(d,{modelValue:l.email,"onUpdate:modelValue":x[0]||(x[0]=I=>l.email=I),placeholder:"請輸入註冊時的信箱",class:"w-full max-w-[250px]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(t,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:_},{default:r(()=>x[1]||(x[1]=[w("送出")])),_:1,__:[1]})])])}}},Ll={class:"relative max-x-md mx-auto mt-10 center-x"},zl={class:"border border-gray-300 w-[90%] mx-auto"},Al={__name:"ResetPassword",setup(u){const m=Me(),a=re(),l=P(null),f=de({newPassword:"",confirmPassword:""}),_={newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請輸入確認密碼",trigger:"blur"},{validator:(x,d,S)=>{d!==f.newPassword?S(new Error("密碼不一致")):S()},trigger:"blur"}]},$=async()=>{try{if(!l.value)return;await l.value.validate();const x=m.query.token,d=await Tt({token:x,newPassword:f.newPassword});d.code===0?(D.success("密碼重設成功，請重新登入"),a.push("/")):D.error(d.message||"密碼重設失敗")}catch(x){console.error("驗證失敗",x),D.error("密碼重設失敗")}};return(x,d)=>{const S=ae,c=ue,t=ie,I=X;return n(),p("div",Ll,[d[3]||(d[3]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"重設密碼",-1)),e("div",zl,[s(t,{model:f,rules:_,ref_key:"formRef",ref:l,class:"p-5 w-[70%] mx-auto mt-3","label-width":"120px"},{default:r(()=>[s(c,{label:"新密碼",prop:"newPassword"},{default:r(()=>[s(S,{modelValue:f.newPassword,"onUpdate:modelValue":d[0]||(d[0]=o=>f.newPassword=o),type:"password","show-password":"",placeholder:"密碼需8-12位，需有英文大小寫及數字"},null,8,["modelValue"])]),_:1}),s(c,{label:"確認新密碼",prop:"confirmPassword"},{default:r(()=>[s(S,{modelValue:f.confirmPassword,"onUpdate:modelValue":d[1]||(d[1]=o=>f.confirmPassword=o),type:"password","show-password":"",placeholder:"請輸入相同的新密碼"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(I,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:$},{default:r(()=>d[2]||(d[2]=[w("重設密碼")])),_:1,__:[2]})])])}}},Ye=We({history:Ze("/breakfast-frontend/"),routes:[{path:"/",component:Xt,children:[{path:"",name:"home",component:ns},{path:"about",name:"about",component:us},{path:"checkout",name:"checkout",component:to},{path:"register",name:"register",component:ro},{path:"product",name:"product",component:Ko},{path:"history",name:"history",component:kl},{path:"forgot-password",name:"forgotPassword",component:Ul},{path:"reset-password",name:"resetPassword",component:Al},{path:"member",name:"member",component:Il,meta:{requiresAuth:!0},children:[{path:"",name:"memberProfile",component:Dl,meta:{requiresAuth:!0}},{path:"change-password",name:"changePassword",component:ql,meta:{requiresAuth:!0}}]}]}]});Ye.beforeEach((u,m,a)=>{const l=se();u.matched.some(f=>f.meta.requiresAuth)?l.isLoggedIn?a():a({path:"/",query:{redirect:u.fullPath}}):a()});const Se=Ge(bt),Nl=Ke();Se.use(Nl);Se.use(Ye);Se.mount("#app");
