import{r as C,c as G,y as oe,K as W,u as $,aF as qe,aG as ae,o as n,aH as Ee,W as ie,L as r,O as s,s as e,a6 as h,m,I as L,a9 as H,Q as v,aI as Ne,aJ as Re,aK as Ye,x as ce,X as He,J as te,aL as je,al as Me,H as N,D as Pe,A as Be,aM as Fe,aN as Oe,aO as Je,aP as We,aQ as Ze}from"./vue-Bh8DP11B.js";import{A as Ge,B as be,C as Ke}from"./vendor-BzJnPsC_.js";import{E as de,a as ue,b as re,c as X,d as we,e as S,f as me,m as Qe,g as Xe,h as et,i as tt,j as Ue,t as st,l as ot,k as lt,n as at,o as Le,p as ze,q as ye,r as rt,s as nt,u as it,v as dt,w as ut,x as ct,y as mt,z as pt,A as ft,B as vt,C as _t,D as gt,F as xt}from"./element-plus-p277nmdm.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))l(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const P of _.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&l(P)}).observe(document,{childList:!0,subtree:!0});function a(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function l(p){if(p.ep)return;p.ep=!0;const _=a(p);fetch(p.href,_)}})();const ee=Ge.create({baseURL:"https://superb-tiglon-wizluna1212-8f061ac6.koyeb.app",timeout:6e4});ee.interceptors.request.use(f=>{const a=se().token;return a&&(f.headers.Authorization=`Bearer ${a}`),f},f=>Promise.reject(f));ee.interceptors.response.use(f=>f.data&&f.data.code===0?f.data:Promise.reject(new Error(f.data.message||"API請求錯誤")),f=>Promise.reject(f));function bt(){return ee({url:"/banners",method:"get"})}function wt(){return ee({url:"/menu",method:"get"})}function yt(f){return ee({url:"/orders",method:"post",data:f})}function ht(f){return ee({url:"/login",method:"post",data:f})}function kt(f){return ee({url:"/register",method:"post",data:f})}function $t(f,u){return ee({url:`/users/${f}/profile`,method:"put",data:u})}function It(){return ee({url:"/orders/history",method:"get"})}function Vt(f,u){return ee({url:`/users/${f}`,method:"patch",data:u})}function Ct(f){return ee({url:"/forgot-password",method:"post",data:f})}function Pt(f){return ee({url:"/reset-password",method:"post",data:f})}const R=(f,u)=>{console.log(f,JSON.parse(JSON.stringify(u)))},Te=be("orderHistory",()=>{const f=C([]),u=se(),a=G(()=>!u.token),l=()=>{const i=JSON.parse(localStorage.getItem("guest-orders")||"[]");f.value=i},p=async()=>{try{if(!u.token)throw new Error("未登入，無法取得歷史訂單");const i=await It();f.value=Array.isArray(i.data)?i.data:[]}catch(i){console.error("取得歷史訂單失敗",i),l()}},_=i=>{const D=JSON.parse(JSON.stringify(i));f.value.push(D),u.token||localStorage.setItem("guest-orders",JSON.stringify(f.value))},P=()=>{f.value=[]},g=async()=>{a.value?l():await p()};return oe(()=>u.token,async i=>{i?await p():l()},{immediate:!0}),{historyOrders:f,loadGuestOrders:l,fetchHistoryOrders:p,addOrder:_,clearHistory:P,init:g}}),se=be("user",{state:()=>({token:localStorage.getItem("token")||"",userInfo:{id:null,name:"",email:"",phone:"",birthday:"",createdAt:""}}),getters:{isLoggedIn:f=>!!f.token&&!!f.userInfo.id,userId:f=>f.userInfo.id},actions:{setToken(f){this.token=f,localStorage.setItem("token",f)},setUserInfo(f){this.userInfo=f},logout(){this.token="",this.userInfo={id:null,name:"",email:"",phone:"",birthday:"",createdAt:""},orderData.name="",orderData.phone="",localStorage.removeItem("token"),Te().clearHistory()}}}),Tt={__name:"App",setup(f){const u=ae(),a=se();return oe(()=>a.isLoggedIn,l=>{const p=u.currentRoute.value;l?["register","forgotPassword","resetPassword"].includes(p.name)&&u.push("/"):["memberProfile","changePassword"].includes(p.name)&&u.push("/")},{immediate:!0}),(l,p)=>(n(),W($(qe)))}},St={class:"center-x"},Dt={__name:"Login",setup(f,{expose:u}){const a=C(!1),l=C(null),p=ae(),_=Ee(),P=se(),g=ie({email:"",password:""}),i={email:[{required:!0,message:"請輸入信箱",trigger:"blur"},{type:"email",message:"信箱格式錯誤",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:6,message:"密碼至少需 6 碼",trigger:"blur"}]},D=async()=>{var y;try{if(!l.value)return;await l.value.validate();const o=await ht({...g});o.code===0&&(P.setUserInfo(o.data.user),P.setToken(o.data.token),R("登入成功，會員資料：",P.userInfo),R("登入成功，token：",P.token),R("登入狀態：",P.isLoggedIn),S.success("登入成功"),a.value=!1,_.path==="/register"&&p.push("/"))}catch(o){if(o.response)switch(o.response.status){case 401:S.error("找不到此帳號");break;case 403:S.error("密碼錯誤");break;default:S.error(((y=o.response.data)==null?void 0:y.message)||"登入失敗")}console.error("登入錯誤：",o)}},c=()=>{a.value=!1,l.value.resetFields()},t=()=>{a.value=!1,p.push("/forgot-password")};return u({open:()=>a.value=!0}),(y,o)=>{const x=re,I=ue,Y=de,E=X,q=we;return n(),W(q,{modelValue:a.value,"onUpdate:modelValue":o[2]||(o[2]=w=>a.value=w),title:"會員登入","before-close":c,class:"center-xy w-[400px] flex-col"},{default:r(()=>[s(Y,{model:g,rules:i,ref_key:"formRef",ref:l},{default:r(()=>[s(I,{label:"信箱",prop:"email"},{default:r(()=>[s(x,{modelValue:g.email,"onUpdate:modelValue":o[0]||(o[0]=w=>g.email=w),placeholder:"請輸入信箱"},null,8,["modelValue"])]),_:1}),s(I,{label:"密碼",prop:"password"},{default:r(()=>[s(x,{modelValue:g.password,"onUpdate:modelValue":o[1]||(o[1]=w=>g.password=w),type:"password",placeholder:"請輸入密碼"},null,8,["modelValue"]),e("div",{class:"text-gray-500 cursor-pointer hover:text-red-600-500",onClick:t}," 忘記密碼 ")]),_:1})]),_:1},8,["model"]),e("div",St,[s(E,{onClick:c},{default:r(()=>o[3]||(o[3]=[h("取消")])),_:1,__:[3]}),s(E,{type:"primary",onClick:D},{default:r(()=>o[4]||(o[4]=[h("登入")])),_:1,__:[4]})])]),_:1},8,["modelValue"])}}},Ot={class:"p-2 pt-3 mx-3 border-b border-gray-200 shadow-sm"},qt={class:"flex flex-col md:flex-row md:items-center md:justify-between relative"},Et={class:"hidden xs:center-y"},Mt={class:"flex space-x-3 pr-3"},Ut={key:0,class:"center-y !px-0 !justify-start"},Lt={key:1,class:"mr-3"},zt={class:"flex flex-col space-y-2 items-start px-2"},At={class:"flex justify-center pt-3 w-full"},Nt={class:"w-full px-2"},Rt={key:0,class:"flex justify-start space-x-2"},Yt={key:1,class:"flex justify-start items-center space-x-2"},Ht={__name:"Header",setup(f){const u=C(null),a=se(),l=C(!1),p=ae(),_=[{label:"產品列表",path:"/product"},{label:"查詢訂單",path:"/history"},{label:"會員",path:"/member"},{label:"關於",path:"/about"}],P=G(()=>a.isLoggedIn?_.filter(c=>c.label!=="註冊"):_),g=()=>{u.value.open()},i=()=>{a.isLoggedIn||g()},D=c=>{l.value=!1,p.push(c)};return(c,t)=>{const y=me,o=X,x=et,I=Xe,Y=tt,E=Ue;return n(),m("header",Ot,[e("div",qt,[e("p",{class:"text-lg font-extrabold text-center md:text-left mb-2 md:mb-0",onClick:t[0]||(t[0]=q=>c.$router.push("/"))}," 晨光早餐店 "),s(o,{class:"xs:hidden absolute -right-1 -top-1 hover:bg-orange-100",onClick:t[1]||(t[1]=q=>l.value=!0),circle:""},{default:r(()=>[s(y,null,{default:r(()=>[s($(Qe))]),_:1})]),_:1}),e("div",Et,[e("nav",Mt,[(n(!0),m(L,null,H(P.value,q=>(n(),m(L,{key:q.path},[q.label==="會員"?(n(),m(L,{key:0},[$(a).isLoggedIn?(n(),W(Y,{key:0,trigger:"click"},{dropdown:r(()=>[s(I,null,{default:r(()=>[s(x,{onClick:t[2]||(t[2]=w=>c.$router.push("/member"))},{default:r(()=>t[9]||(t[9]=[h("修改會員資料")])),_:1,__:[9]}),s(x,{onClick:t[3]||(t[3]=w=>c.$router.push("/member/change-password"))},{default:r(()=>t[10]||(t[10]=[h("修改密碼")])),_:1,__:[10]})]),_:1})]),default:r(()=>[s(o,{link:"",class:"!h-[32px]"},{default:r(()=>[h(v(q.label),1)]),_:2},1024)]),_:2},1024)):(n(),W(o,{key:1,link:"",class:"!h-[32px]",onClick:i},{default:r(()=>[h(v(q.label),1)]),_:2},1024))],64)):(n(),W(o,{key:1,link:"",onClick:w=>c.$router.push(q.path),class:"!h-[32px]"},{default:r(()=>[h(v(q.label),1)]),_:2},1032,["onClick"]))],64))),128))]),e("div",null,[$(a).isLoggedIn?(n(),m("span",Lt,[h("歡迎 "+v($(a).userInfo.name)+" ",1),s(o,{onClick:$(a).logout,link:""},{default:r(()=>t[14]||(t[14]=[h("登出")])),_:1,__:[14]},8,["onClick"])])):(n(),m("div",Ut,[s(o,{onClick:t[4]||(t[4]=q=>c.$router.push("/register")),link:""},{default:r(()=>t[11]||(t[11]=[h("註冊")])),_:1,__:[11]}),t[13]||(t[13]=e("span",{class:"text-gray-300"},"/",-1)),s(o,{onClick:g,link:""},{default:r(()=>t[12]||(t[12]=[h("登入")])),_:1,__:[12]})]))])])]),s(Dt,{ref_key:"loginRef",ref:u},null,512),s(E,{modelValue:l.value,"onUpdate:modelValue":t[8]||(t[8]=q=>l.value=q),direction:"rtl",size:"200px","with-header":!1,class:"md:hidden"},{default:r(()=>[e("nav",zt,[(n(!0),m(L,null,H(P.value,q=>(n(),m("div",{key:q.path,class:"w-full"},[q.label==="會員"?(n(),m(L,{key:0},[$(a).isLoggedIn?(n(),W(Y,{key:0,trigger:"click"},{dropdown:r(()=>[s(I,null,{default:r(()=>[s(x,{onClick:t[5]||(t[5]=w=>D("/member"))},{default:r(()=>t[15]||(t[15]=[h("修改會員資料")])),_:1,__:[15]}),s(x,{onClick:t[6]||(t[6]=w=>D("/member/change-password"))},{default:r(()=>t[16]||(t[16]=[h("修改密碼")])),_:1,__:[16]})]),_:1})]),default:r(()=>[s(o,{link:"",class:"!h-[32px]"},{default:r(()=>[h(v(q.label),1)]),_:2},1024)]),_:2},1024)):(n(),W(o,{key:1,link:"",class:"!h-[32px]",onClick:i},{default:r(()=>[h(v(q.label),1)]),_:2},1024))],64)):(n(),W(o,{key:1,link:"",onClick:w=>D(q.path),class:"!h-[32px]"},{default:r(()=>[h(v(q.label),1)]),_:2},1032,["onClick"]))]))),128))]),e("div",At,[e("div",Nt,[$(a).isLoggedIn?(n(),m("div",Yt,[e("span",null,"歡迎 "+v($(a).userInfo.name),1),s(o,{onClick:$(a).logout,link:""},{default:r(()=>t[20]||(t[20]=[h("登出")])),_:1,__:[20]},8,["onClick"])])):(n(),m("div",Rt,[s(o,{onClick:t[7]||(t[7]=q=>c.$router.push("/register")),link:""},{default:r(()=>t[17]||(t[17]=[h("註冊")])),_:1,__:[17]}),t[19]||(t[19]=e("span",{class:"text-gray-300"},"/",-1)),s(o,{onClick:g,link:""},{default:r(()=>t[18]||(t[18]=[h("登入")])),_:1,__:[18]})]))])])]),_:1},8,["modelValue"])])}}},jt={class:"bg-orange-400 py-5 text-white"},Bt={class:"w-full mx-auto md:h-[260px] px-6"},Ft={class:"mx-auto grid grid-cols-1 md:grid-cols-3 gap-4"},Jt={class:"flex gap-3 items-center"},Wt={href:"https://www.instagram.com/",target:"_blank",rel:"noopener","aria-label":"Instagram"},Zt={href:"https://www.facebook.com/",target:"_blank",rel:"noopener","aria-label":"Facebook"},Gt={__name:"Footer",setup(f){const u=()=>{window.scrollTo({top:0,behavior:"smooth"})};return(a,l)=>{const p=me;return n(),m("footer",jt,[e("div",Bt,[e("div",Ft,[l[2]||(l[2]=e("div",null,[e("h2",{class:"font-bold text-2xl pb-2"},"晨光早餐店"),e("div",null,"地址:台灣"),e("div",null,"電話:02-1234-5678"),e("div",null,"Email：breakfast@example.com"),e("div",{class:"pt-1"},"營業時間：每日 06:00 - 15:00")],-1)),e("div",null,[l[1]||(l[1]=e("h2",{class:"font-bold text-2xl pb-2"},"快速連結",-1)),e("div",Jt,[s($(Ne),{class:"w-6 h-6 text-amber-800",onClick:l[0]||(l[0]=_=>a.$router.push("/"))}),e("a",Wt,[s($(Re),{class:"w-6 h-6 text-pink-500"})]),e("a",Zt,[s($(Ye),{class:"w-6 h-6 text-blue-600"})])])]),l[3]||(l[3]=e("div",null,[e("h2",{class:"font-bold text-2xl pb-2"},"店鋪位置"),e("div",{class:"w-full h-25 rounded overflow-hidden"},[e("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3621.2891151693194!2d120.80247207521537!3d23.50830888470479!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x346e9a3b87a7b195%3A0x4d403f78057f3721!2z5paw5r2t5ZyL56uL!5e0!3m2!1szh-TW!2stw!4v1716035061319!5m2!1szh-TW!2stw",frameborder:"0",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"})])],-1))]),l[4]||(l[4]=e("div",{class:"text-center pt-3"},"© 2025 晨光早餐店 All rights reserved.此網站為練習作品",-1)),l[5]||(l[5]=e("div",{class:"text-center"},"商品頁圖片來源：Unsplash、pexels",-1)),e("div",{class:"fixed bottom-6 right-3 h-10 w-10 center-xy rounded-full bg-orange-900",onClick:u},[s(p,null,{default:r(()=>[s($(st))]),_:1})])])])}}},Kt={class:"flex flex-col min-h-screen"},Qt={class:"flex-1"},Xt={__name:"default",setup(f){return(u,a)=>(n(),m("div",Kt,[s(Ht),e("main",Qt,[s($(qe))]),s(Gt)]))}},es={class:"absolute inset-0 bg-slate-50 z-50 center-xy flex-col text-center"},ts={__name:"LoadingOverlay",setup(f){return(u,a)=>{const l=me;return n(),m("div",es,[s(l,{class:"animate-spin text-5xl text-orange-400 mb-6"},{default:r(()=>[s($(ot))]),_:1}),a[0]||(a[0]=e("h2",{class:"text-2xl font-semibold text-orange-400 mb-2"},"正在載入中...",-1)),a[1]||(a[1]=e("p",{class:"text-orange-400 text-lg leading-relaxed px-6"},[h(" 免費伺服器會在閒置時自動休眠，"),e("br"),h(" 請耐心等候 ")],-1))])}}},ss={class:"w-full"},os=["src","alt"],ls={class:"absolute inset-0 z-20 text-white center-xy flex-col space-y-3"},as={class:"text-3xl md:text-5xl font-bold"},rs={class:"text-xl md:text-3xl font-bold"},ns={__name:"Home",setup(f){const u=C([]),a=C(!1),l=C(!1),p=C(!0),_=async(g=3)=>{try{p.value=!0;const i=await bt();if(i.code===0)u.value=i.data.list;else throw new Error("取得輪播資料失敗")}catch(i){console.error("API 請求失敗:",i),g>0?(console.log(`重新嘗試獲取輪播圖 (${3-g+1}/3)...`),setTimeout(()=>_(g-1),1e3)):S.error("取得輪播資料失敗")}finally{p.value=!1}},P=async()=>{a.value=!1,l.value=!1,await _(),setTimeout(()=>{a.value=!0},100),setTimeout(()=>{l.value=!0},1500)};return ce(async()=>{await P()}),He(async()=>{await P()}),(g,i)=>{const D=X,c=at,t=lt;return n(),m("div",ss,[s(t,{interval:0,class:"relative h-[60vh] md:h-[600px] xl:h-[700px]"},{default:r(()=>[(n(!0),m(L,null,H(u.value,y=>(n(),W(c,{key:y.id,class:"h-[60vh] md:h-[600px] xl:h-[700px]"},{default:r(()=>[e("img",{src:`/breakfast-frontend/images/${y.image}.jpg`,alt:y.title,loading:"lazy",class:"h-full w-full object-cover"},null,8,os),i[1]||(i[1]=e("div",{class:"absolute inset-0 z-10 bg-black bg-opacity-10"},null,-1)),e("div",ls,[e("div",{class:te(["center-xy flex-col text-shadow space-y-4 opacity-0 transition-opacity duration-[2000ms]",{"opacity-100":a.value}])},[e("h2",as,v(y.title),1),e("p",rs,v(y.description),1)],2),e("div",{class:te(["transition duration-700",{"translate-y-6 opacity-0":!l.value,"translate-y-0 opacity-100":l.value}])},[s(D,{href:y.ctaLink||"#",type:"default",class:"!bg-white !text-black !rounded-full !px-6 !py-3 !text-lg !font-semibold !border-none hover:opacity-90 transition duration-300",onClick:i[0]||(i[0]=o=>g.$router.push("/product"))},{default:r(()=>[h(v(y.ctaText),1)]),_:2},1032,["href"])],2)])]),_:2,__:[1]},1024))),128))]),_:1})])}}},is={class:"max-w-4xl mx-auto p-6"},ds={class:"relative"},us=Object.assign({name:"AboutPage"},{__name:"About",setup(f){return(u,a)=>{const l=Me("H1");return n(),m("div",is,[e("div",ds,[s(l,{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-4 text-2xl text-gray-700 font-semibold whitespace-nowrap text-center"},{default:r(()=>a[0]||(a[0]=[h(" 關於這個專案 ")])),_:1,__:[0]}),a[1]||(a[1]=je('<div class="border-2 border-gray-200 rounded-lg shadow-lg w-[90%] mx-auto p-8 bg-white hover:border-orange-300 transition-colors duration-300"><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> 專案介紹 </h2><p class="mb-4 text-gray-600 leading-relaxed"> 這是一個早餐店點餐系統作品，使用 Vue 3、Pinia 做狀態管理，Element Plus 作為 UI 框架。 包含會員系統、購物車、多種加料選項及訂單查詢等功能，模擬電商流程。 </p><ul class="list-disc pl-6 space-y-2 text-gray-600"><li>商品管理：支援商品分類、搜尋功能，可自定義加料選項</li><li>購物車系統：可加入商品、編輯數量、選擇加料，即時計算總價</li><li>會員系統：提供註冊、登入、登出功能，支援密碼重設</li><li>訂單查詢：可依照會員或訪客身分顯示各自的訂單</li><li>響應式設計：支援各種裝置尺寸，提供最佳使用體驗</li></ul></section><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> 技術棧 </h2><ul class="list-disc ml-5 text-gray-600"><li>Vue 3 + Composition API</li><li>Pinia 狀態管理</li><li>Element Plus UI 元件</li><li>TailwindCSS</li><li>Axios 請求 API</li><li>JSON Server + Express 模擬後端</li></ul></section><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> 專案動機 </h2><p class="text-gray-600 leading-relaxed"> 非本科背景，轉職學習前端開發，並以 Vue製作前後端分離的電商網站作為實作練習，整合登入驗證、購物車與查詢訂單等功能。 </p></section><section class="mb-8"><h2 class="text-xl font-semibold mb-3 text-gray-700 border-b border-gray-100 pb-2"> GitHub 原始碼 </h2><p><a href="https://github.com/wizluna1212/breakfast-frontend.git" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200"> 原始碼連結 </a></p></section></div>',1))])])}}}),he=be("cart",()=>{const f=C([]),u=C(!1),a=C(null),l=C(!1),p=o=>{const x=o.price*o.quantity,I=o.extras.reduce((Y,E)=>Y+E.options.reduce((q,w)=>q+w.price*(w.quantity||1),0),0);return x+I*o.quantity},_=G(()=>f.value.reduce((o,x)=>o+p(x),0)),P=G(()=>f.value.reduce((o,x)=>o+x.quantity,0));return{cartItems:f,showCart:u,editingItem:a,showProduct:l,totalPrice:_,cartCount:P,toggleCart:()=>{u.value=!u.value},setEditingItem:o=>{a.value={...o}},clearEditingItem:()=>{a.value=null,l.value=!1},addToCart:(o,x)=>{try{const I=a.value?a.value.cartId:o.cartId,Y={cartId:I,cateId:o.cateId,prodId:o.prodId||o.id,name:o.name,price:o.price,quantity:o.quantity||1,extraType:o.extraType,extras:x||[],image:o.image};R("準備加入的購物車項目:",Y);const E=f.value.findIndex(w=>{const Z=w.prodId===Y.prodId,B=JSON.stringify(w.extras)===JSON.stringify(Y.extras),pe=!a.value||w.cartId!==a.value.cartId;return Z&&B&&pe}),q=a.value?f.value.findIndex(w=>w.cartId===I):-1;E!==-1?(f.value[E].quantity+=o.quantity||1,S.success("已合併相同商品"),q!==-1&&f.value.splice(q,1)):q!==-1?(f.value[q]=Y,S.success("更新購物車成功")):(f.value.push(Y),S.success("加入購物車成功")),R("當前購物車內容:",f.value)}catch(I){R("加入購物車錯誤:",I),S.error("加入購物車失敗")}},removeFromCart:o=>{const x=f.value.findIndex(I=>I.cartId===o);x!==-1&&(f.value.splice(x,1),S.success("移除商品成功"))},clearCart:()=>{f.value=[],S.success("清空購物車成功")},getItemTotal:p}}),cs=be("order",()=>{const f=he(),u=se(),a=ie({name:"",phone:"",note:"",pickupType:"",tableNumber:"",takeTime:"",paymentMethod:"cash"}),l=C(null),p=()=>{a.name="",a.phone="",a.note="",a.pickupType="",a.tableNumber="",a.takeTime="",a.paymentMethod="cash"};return{orderData:a,completedOrder:l,generateOrderData:()=>{const g=!!u.token,i={customer:{name:a.name,phone:a.phone},pickupType:a.pickupType,tableNumber:a.tableNumber||"",takeTime:a.takeTime||"",paymentMethod:a.paymentMethod,items:f.cartItems,totalPrice:f.totalPrice,note:a.note||""};return i.tableNumber||delete i.tableNumber,i.note||delete i.note,g&&(i.userId=u.userId),R("準備送出的訂單數據：",i),i},fetchSendOrder:async g=>{try{const i=await yt(g);if(i.code===0){const D={...g,orderId:i.data.orderId,timestamp:i.data.timestamp};return l.value=D,R("訂單送出成功，完整訂單數據：",D),f.cartItems=[],p(),l.value}else throw new Error(i.message||"送出訂單失敗")}catch(i){throw console.error("送出訂單錯誤:",i),S.error(i.message||"送出訂單失敗"),i}},resetOrderData:p}}),ms={class:"min-h-screen flex flex-col max-w-5xl mx-auto"},ps={class:"bg-gray-100 w-full center-xy"},fs={class:"flex-grow"},vs={key:0,class:"center-xy flex flex-col"},_s={class:"w-[80%]"},gs={class:"center-xy py-1"},xs={class:"w-1/2 text-lg"},bs={class:"w-1/4 text-center"},ws={class:"w-1/4 text-right pr-2"},ys={key:0},hs={class:"w-1/2 pl-4"},ks={class:"w-1/4 text-center"},$s={class:"w-1/4 text-right pr-2"},Is={class:"center-xy py-2 mt-2"},Vs={class:"text-2xl font-bold text-red-500 ml-2"},Cs={key:0,class:"text-red-500 text-sm mt-1"},Ps={key:1,class:"w-[240px] center-xy mt-4 flex-col"},Ts={key:2},Ss={class:"border !rounded-full w-[300px] h-8 text-center"},Ds={class:"border !rounded-full w-[300px] h-8 text-center"},Os={key:3},qs={key:1,class:"center-x w-full"},Es={class:"w-full sm:w-[80%] flex flex-col p-2"},Ms={class:"font-semibold pr-2"},Us={class:"m-1"},Ls={class:"center-xy py-1"},zs={class:"w-1/2 text-lg"},As={class:"w-1/4 text-center"},Ns={class:"w-1/4 text-right pr-2"},Rs={key:0},Ys={class:"w-1/2 pl-4"},Hs={class:"w-1/4 text-center"},js={class:"w-1/4 text-right pr-2"},Bs={class:"bg-orange-200 rounded w-full text-center h-8 center-xy"},Fs={class:"text-red-500"},Js={key:2,class:"center-x w-full my-8 p-2"},Ws={key:0,class:"space-y-2"},Zs={class:"py-2"},Gs={class:"py-4"},Ks={class:"center-xy"},Qs={key:3,class:"sticky bottom-0 left-0 w-full h-12 mt-4 bg-gray-100 z-10 center-xy"},Xs={key:0},eo={key:1},to={__name:"Checkout",setup(f){const u=C(null),a=he(),l=cs(),p=se(),_=Te(),P=ae(),g=G(()=>a.cartItems),i=G(()=>a.cartCount),D=G(()=>a.totalPrice),c=l.orderData,t=C(1),y=C(!1),o=C(""),x=C(null),I=C(""),Y=C(null),E=C(""),q=C([]),w=C(""),Z=C(""),B=C(""),pe=G(()=>[{label:"取餐方式:",value:o.value==="dine-in"?`內用: ${w.value}桌`:o.value==="takeout"?"外帶":""},{label:"取餐時間:",value:Z},{label:"店家地址:",value:"台灣的某個地方"},{label:"店家電話:",value:"02-1234-5678"}]),fe=G(()=>{const A=new Date,d=A.getHours(),b=A.getMinutes(),j=d>6||d===6&&b>=0,V=d<15||d===15&&b===0;return j&&V}),T=A=>{if(A==="dine-in"&&!fe.value){S.warning("目前不在營業時間內，無法選擇內用");return}o.value=A;const d=new Date,b=new Date(d.getTime()+21*6e4);if(A==="dine-in")B.value=b.toISOString(),Z.value=K(B.value),R("內用akeTimeISO",B.value),R("內用takeTimeText",Z.value);else if(A==="takeout"){w.value="";const j=d.getHours(),V=j>=15,J=j<=6,le=new Intl.DateTimeFormat("sv-SE").format(b),ve=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}).format(b);if(x.value=le,V)x.value=null,I.value="",B.value="",Z.value="今日已過營業時間，請選擇其它日期";else{J?I.value="06:00":I.value=ve;const _e=`${x.value}T${I.value}:00.000`;B.value=new Date(_e).toISOString(),Z.value=K(B.value),k()}}},U=()=>{y.value&&(Y.value=x.value,E.value=I.value),y.value=!y.value},M=A=>{const d=new Date(A),b=new Date,j=new Date;j.setDate(b.getDate()+6);const V=d.toDateString()===b.toDateString(),J=new Date,le=J.getHours()>15||J.getHours()===15&&J.getMinutes()>0;return d.getTime()<b.setHours(0,0,0,0)||d.getTime()>j.setHours(23,59,59,999)||d.getDay()===0||V&&le},k=()=>{q.value=[];const A=new Date,b=new Date(x.value).toDateString()===A.toDateString(),j=[];for(let V=6;V<=15;V++)for(let J=0;J<60&&!(V===15&&J>0);J+=10){const le=`${String(V).padStart(2,"0")}:${String(J).padStart(2,"0")}`;j.push(le)}if(b){const V=A.getHours()*60+A.getMinutes(),J=6*60,le=15*60;if(V>=le&&V<J){q.value=["今日已過營業時間，請選擇其他日期"],I.value=q.value[0];return}const ve=Math.ceil((V+20)/10)*10;q.value=j.filter(_e=>{const[Ve,Ce]=_e.split(":").map(Number);return Ve*60+Ce>=ve})}else q.value=j;I.value=q.value[0]},z=()=>{x.value=Y.value,I.value=E.value,y.value=!1},F=()=>{R("selectedDate:",x.value),R("selectedTime:",I.value);const A=`${x.value}T${I.value}`;B.value=new Date(A).toISOString(),R("pickupISO外帶時間:",B.value),Z.value=K(B.value),y.value=!1},K=A=>new Date(String(A)).toLocaleString("zh-TW",{timeZone:"Asia/Taipei",year:"numeric",month:"2-digit",day:"2-digit",weekday:"narrow",hour:"2-digit",minute:"2-digit",hour12:!1}).replaceAll("/","-"),ge={name:[{required:!0,message:"請輸入姓名",trigger:"blur"},{pattern:/^[^\d]+$/,message:"姓名不能包含數字",trigger:"blur"}],phone:[{required:!0,message:"請輸入電話",trigger:"blur"},{max:10,message:"手機號碼最多10個數字",trigger:"blur"},{pattern:/^09\d{8}$/,message:"請輸入正確的手機號碼格式",trigger:"blur"}],paymentMethod:[{required:!0,message:"請選擇付款方式",trigger:"change"}]},xe=()=>{a.showCart=!1,P.push("/product")},ke=()=>{t.value=1},$e=()=>{if(g.value.length===0){S.warning("購物車是空的，請選擇商品");return}if(!o.value){S.warning("請選擇取餐方式");return}if(o.value==="dine-in"&&(!w.value||w.value>11)){S.warning("請輸入桌號");return}if(o.value==="takeout"){if(!x.value||!I.value){S.warning("請選擇自取的取餐時間");return}const[A,d]=I.value.split(":").map(Number);if(!(A>=6&&(A<15||A===15&&d===0))){S.warning("自取時間請選擇 06:00–15:00 間");return}}o.value==="dine-in"?c.tableNumber=w.value:c.tableNumber="",c.takeTime=B.value,c.pickupType=o.value,t.value=2},Ie=async()=>{if(!await u.value.validate().catch(()=>!1)){S.error("請確認表單資料正確");return}const d=!!p.token;try{let b=await l.generateOrderData();if(R("準備發送的訂單數據：",b),d)await l.fetchSendOrder(b),R("訂單提交結果：",l.completedOrder),S.success(`訂單成功，訂單編號: ${l.completedOrder.orderId}`);else{const j={...b,orderId:`G-${Date.now()}-${Math.floor(Math.random()*1e3)}`,timestamp:new Date().toISOString()};l.completedOrder=j,S.success(`訂單成功（訪客模式），訂單編號: ${j.orderId}`)}_.addOrder(l.completedOrder),a.cartItems=[],l.resetOrderData(),t.value=3,R("完成的訂單資訊：",l.completedOrder)}catch(b){console.error("送出訂單錯誤:",b),S.error(b.message||"送出訂單失敗")}};return oe(x,()=>{x.value&&k()}),oe(()=>t.value,A=>{A===2&&p.isLoggedIn&&(c.name=p.userInfo.name,c.phone=p.userInfo.phone,Pe(()=>{var d;(d=u.value)==null||d.clearValidate()}))}),oe(()=>p.isLoggedIn,A=>{A&&t.value===2?(c.name=p.userInfo.name,c.phone=p.userInfo.phone,Pe(()=>{var d;(d=u.value)==null||d.clearValidate()})):A||(c.name="",c.phone="")}),(A,d)=>{const b=X,j=re,V=ue,J=ze,le=Le,ve=de,_e=ye,Ve=nt,Ce=rt,De=we;return n(),m("div",ms,[e("div",ps,[e("div",{class:te(["flex flex-col xs:flex-row p-4",t.value===1?"border-b-2 border-orange-300":""])},[e("div",{class:te(t.value===1?"text-orange-300 font-bold":"text-gray-400")},"Step 1.",2),e("div",{class:te(t.value===1?"text-black":"text-gray-400")},"取餐方式",2)],2),d[10]||(d[10]=e("div",{class:"text-gray-600"},"➔",-1)),e("div",{class:te(["flex flex-col xs:flex-row p-4",t.value===2?"border-b-2 border-orange-300":""])},[e("div",{class:te(t.value===2?"text-orange-300 font-bold":"text-gray-400")},"Step 2.",2),e("div",{class:te(t.value===2?"text-black":"text-gray-400")},"訂購資訊",2)],2),e("div",{class:te(["flex flex-col xs:flex-row p-4",t.value===3?"border-b-2 border-orange-300":""])},[e("div",{class:te(t.value===3?"text-orange-300 font-bold":"text-gray-400")},"Step 3.",2),e("div",{class:te(t.value===3?"text-black":"text-gray-400")},"訂購完成",2)],2)]),e("div",fs,[t.value===1?(n(),m("div",vs,[d[21]||(d[21]=e("div",{class:"mt-4 p-2 font-semibold text-lg"},"商品明細",-1)),e("div",_s,[d[12]||(d[12]=e("div",{class:"center-x border-b py-1 font-bold bg-gray-100 text-gray-400 text-center"},[e("div",{class:"w-1/2"},"商品名稱"),e("div",{class:"w-1/4"},"數量"),e("div",{class:"w-1/4 text-right pr-2"},"價格")],-1)),(n(!0),m(L,null,H(g.value,O=>(n(),m("div",{key:O.cartId,class:"border-b"},[e("div",gs,[e("div",xs,v(O.name),1),e("div",bs,v(O.quantity),1),e("div",ws,"$"+v(O.price*O.quantity),1)]),O.extras&&O.extras.length>0?(n(),m("div",ys,[(n(!0),m(L,null,H(O.extras,ne=>(n(),m("div",{key:ne.id},[(n(!0),m(L,null,H(ne.options,Q=>(n(),m("div",{key:Q.id,class:"center-xy w-full py-1"},[e("div",hs,v(Q.name)+" ($"+v(Q.price)+")",1),e("div",ks,v(Q.quantity)+"(每份)",1),e("div",$s," $"+v(Q.price*Q.quantity*O.quantity),1)]))),128))]))),128))])):N("",!0)]))),128)),e("div",Is,[d[11]||(d[11]=e("span",{class:"text-lg font-bold"},"小計：",-1)),e("span",Vs,"$"+v(D.value),1)])]),d[22]||(d[22]=e("div",{class:"mt-4 p-2 font-semibold text-lg"},"取餐方式",-1)),e("div",null,[s(b,{class:"!rounded-full",type:o.value==="dine-in"?"primary":"default",onClick:d[0]||(d[0]=O=>T("dine-in")),disabled:!fe.value},{default:r(()=>d[13]||(d[13]=[h("內用")])),_:1,__:[13]},8,["type","disabled"]),s(b,{class:"!rounded-full",type:o.value==="takeout"?"primary":"default",onClick:d[1]||(d[1]=O=>T("takeout"))},{default:r(()=>d[14]||(d[14]=[h("自取")])),_:1,__:[14]},8,["type"])]),fe.value?N("",!0):(n(),m("div",Cs," 目前不在營業時間內，無法選擇內用 ")),o.value==="dine-in"?(n(),m("div",Ps,[e("div",null,[d[15]||(d[15]=h("桌號：")),s(j,{modelValue:w.value,"onUpdate:modelValue":d[2]||(d[2]=O=>w.value=O),class:"!w-10"},null,8,["modelValue"]),d[16]||(d[16]=h("桌"))]),d[17]||(d[17]=e("div",null,"請確認有座位後再填寫桌號，謝謝",-1))])):N("",!0),o.value==="dine-in"?(n(),m("div",Ts,[d[18]||(d[18]=e("div",{class:"mt-4 p-2 font-semibold text-lg center-xy"},"桌號",-1)),e("div",Ss,v(w.value)+"桌",1),d[19]||(d[19]=e("div",{class:"mt-4 p-2 font-semibold text-lg center-xy"},"取餐時間",-1)),e("div",Ds,v(Z.value),1)])):N("",!0),o.value==="takeout"?(n(),m("div",Os,[d[20]||(d[20]=e("div",{class:"mt-4 p-2 font-semibold text-lg center-xy"},"取餐時間",-1)),e("div",{class:"border !rounded-full w-[300px] h-8 text-center",onClick:U},v(Z.value),1)])):N("",!0)])):N("",!0),t.value===2?(n(),m("div",qs,[e("div",Es,[d[26]||(d[26]=e("div",{class:"center-x text-xl pt-5 font-semibold"},"早餐店",-1)),(n(!0),m(L,null,H(pe.value,(O,ne)=>(n(),m("div",{key:ne,class:"border-b w-full p-2"},[e("span",Ms,v(O.label),1),e("span",null,v(O.value),1)]))),128)),e("div",Us,[d[23]||(d[23]=e("div",{class:"center-x border-b py-1 font-bold bg-gray-100 text-gray-400 text-center"},[e("div",{class:"w-1/2"},"商品名稱"),e("div",{class:"w-1/4"},"數量"),e("div",{class:"w-1/4 text-right pr-2"},"價格")],-1)),(n(!0),m(L,null,H(g.value,O=>(n(),m("div",{key:O.cartId,class:"border-b"},[e("div",Ls,[e("div",zs,v(O.name),1),e("div",As,v(O.quantity),1),e("div",Ns,"$"+v(O.price*O.quantity),1)]),O.extras&&O.extras.length>0?(n(),m("div",Rs,[(n(!0),m(L,null,H(O.extras,ne=>(n(),m("div",{key:ne.id},[(n(!0),m(L,null,H(ne.options,Q=>(n(),m("div",{key:Q.id,class:"center-xy w-full py-1"},[e("div",Ys,v(Q.name)+" ($"+v(Q.price)+")",1),e("div",Hs,v(Q.quantity)+"(每份)",1),e("div",js," $"+v(Q.price*Q.quantity*O.quantity),1)]))),128))]))),128))])):N("",!0)]))),128))]),e("div",Bs,[h(" 總共"+v(i.value)+"項/",1),e("span",Fs,"$"+v(D.value),1)]),d[27]||(d[27]=e("div",{class:"center-x text-xl pt-5 font-semibold"},"請輸入訂購資訊",-1)),s(ve,{model:$(c),rules:ge,"label-width":"100px",class:"max-w-md mx-auto",ref_key:"formRef",ref:u},{default:r(()=>[s(V,{label:"訂購人姓名",prop:"name"},{default:r(()=>[s(j,{modelValue:$(c).name,"onUpdate:modelValue":d[3]||(d[3]=O=>$(c).name=O),placeholder:"請輸入姓名"},null,8,["modelValue"])]),_:1}),s(V,{label:"手機號碼",prop:"phone"},{default:r(()=>[s(j,{modelValue:$(c).phone,"onUpdate:modelValue":d[4]||(d[4]=O=>$(c).phone=O),placeholder:"請輸入手機號碼，如0910123456",maxlength:"10"},null,8,["modelValue"])]),_:1}),s(V,{label:"付款方式",prop:"paymentMethod"},{default:r(()=>[s(le,{modelValue:$(c).paymentMethod,"onUpdate:modelValue":d[5]||(d[5]=O=>$(c).paymentMethod=O)},{default:r(()=>[s(J,{value:"cash"},{default:r(()=>d[24]||(d[24]=[h("現金付款")])),_:1,__:[24]}),s(J,{value:"linPay",disabled:!0},{default:r(()=>d[25]||(d[25]=[h("Line pay(尚未開放)")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),s(V,{label:"訂單備註",prop:"note"},{default:r(()=>[s(j,{modelValue:$(c).note,"onUpdate:modelValue":d[6]||(d[6]=O=>$(c).note=O),type:"textarea",rows:2,placeholder:"有需要可填寫備註"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])])):N("",!0),t.value===3?(n(),m("div",Js,[$(l).completedOrder?(n(),m("div",Ws,[d[28]||(d[28]=e("p",{class:"text-lg font-semibold"},"您的訂單已成功送出！",-1)),e("p",null,"訂單編號："+v($(l).completedOrder.orderId),1),e("p",null," 取餐方式："+v($(l).completedOrder.pickupType==="dine-in"?"內用":"外帶"),1),e("p",null,v($(l).completedOrder.pickupType==="dine-in"?`桌號： ${$(l).completedOrder.tableNumber} `:`請於  ${K($(l).completedOrder.takeTime)}
            後取餐。`),1),e("p",null," 付款方式："+v($(l).completedOrder.paymentMethod==="cash"?"現金，取餐時付款":"信用卡"),1),e("p",null,"總金額："+v($(l).completedOrder.totalPrice)+"元",1),d[29]||(d[29]=e("p",null,"感謝您的訂購！如有需要，請洽現場服務人員或撥打店家電話。",-1))])):N("",!0)])):N("",!0),s(De,{modelValue:y.value,"onUpdate:modelValue":d[9]||(d[9]=O=>y.value=O),class:"center-xy w-full xs:w-[70%] max-w-md"},{default:r(()=>[e("div",Zs,[d[30]||(d[30]=e("div",{class:"text-lg"},"選擇日期",-1)),s(_e,{modelValue:x.value,"onUpdate:modelValue":d[7]||(d[7]=O=>x.value=O),type:"date","place-holder":"selectedDate","disabled-date":M,format:"YYYY-MM-DD ( ddd )","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),e("div",Gs,[d[31]||(d[31]=e("div",{class:"text-lg"},"選擇時間",-1)),s(Ce,{modelValue:I.value,"onUpdate:modelValue":d[8]||(d[8]=O=>I.value=O),disabled:!x.value,placeholder:"請先選擇日期"},{default:r(()=>[(n(!0),m(L,null,H(q.value,O=>(n(),W(Ve,{key:O,label:A.formatTime,value:O},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),e("div",Ks,[s(b,{onClick:z},{default:r(()=>d[32]||(d[32]=[h("關閉")])),_:1,__:[32]}),s(b,{type:"primary",onClick:F},{default:r(()=>d[33]||(d[33]=[h("確定")])),_:1,__:[33]})])]),_:1},8,["modelValue"]),t.value!==3?(n(),m("div",Qs,[t.value===1?(n(),m("div",Xs,[s(b,{class:"!rounded-full w-[120px] !text-white !bg-gray-500",onClick:xe},{default:r(()=>d[34]||(d[34]=[h("繼續選購")])),_:1,__:[34]}),s(b,{class:"!rounded-full w-[120px] !text-white !bg-orange-400",onClick:$e},{default:r(()=>d[35]||(d[35]=[h("下一步")])),_:1,__:[35]})])):N("",!0),t.value===2?(n(),m("div",eo,[s(b,{class:"!rounded-full w-[120px] !text-white !bg-gray-500",onClick:ke},{default:r(()=>d[36]||(d[36]=[h("上一步")])),_:1,__:[36]}),s(b,{class:"!rounded-full w-[120px] !text-white !bg-orange-400",onClick:Ie},{default:r(()=>d[37]||(d[37]=[h("送出訂單")])),_:1,__:[37]})])):N("",!0)])):N("",!0)])])}}},so={class:"relative max-x-md mx-auto mt-10 center-x"},oo={class:"border border-gray-300 w-[90%] mx-auto"},lo={class:"flex flex-col gap-2 xs:flex-row xs:items-center xs:gap-3"},ao={class:"border border-gray-300 px-2 text-center min-w-[60px] h-8"},ro={__name:"Register",setup(f){const u=C(null),a=C(""),l=se(),p=ae(),_=ie({email:"",password:"",confirmPassword:"",name:"",birthday:"",phone:"",captcha:""}),P={email:[{required:!0,message:"請輸入信箱",trigger:"blur"},{type:"email",message:"信箱格式錯誤",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請輸入密碼",trigger:"blur"},{validator:(c,t,y)=>{t!==_.password?y(new Error("密碼不一致")):y()},trigger:"blur"}],name:[{required:!0,message:"請輸入姓名",trigger:"blur"},{pattern:/^[^\d]+$/,message:"姓名不能包含數字",trigger:"blur"}],phone:[{required:!0,message:"請輸入電話",trigger:"blur"},{pattern:/^09\d{2}-\d{6}$/,message:"電話格式長度錯誤",trigger:"blur"}],captcha:[{required:!0,message:"請輸入驗證碼",trigger:"blur"},{pattern:/^\d{4}$/,message:"驗證碼錯誤",trigger:"blur"}]},g=()=>{const c=_.phone.replace(/\D/g,"").slice(0,10);c>4?_.phone=c.slice(0,4)+"-"+c.slice(4):_.phone=c},i=()=>{a.value=Math.floor(1e3+Math.random()*9e3).toString()},D=async()=>{try{if(!u.value)return;if(await u.value.validate(),_.captcha!==a.value){S.error("驗證碼錯誤"),i();return}const c=_.phone.replace(/-/g,""),t=await kt({..._,phone:c,createdAt:Date.now()});t.code===0?(l.setToken(t.data.token),l.setUserInfo(t.data.user),console.log("登入成功",l.userInfo),S.success("註冊成功"),setTimeout(()=>{S.success("登入成功"),p.push("/")},3e3)):(S.error(t.message||"註冊失敗"),i())}catch(c){S.error("請確認所有欄位正確"),console.error("驗證失敗",c),i()}};return ce(()=>{i()}),oe(()=>l.isLoggedIn,c=>{c&&p.push("/")},{immediate:!0}),(c,t)=>{const y=re,o=ue,x=ye,I=X,Y=de;return n(),m("div",so,[t[9]||(t[9]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"會員註冊",-1)),e("div",oo,[s(Y,{model:_,rules:P,ref_key:"formRef",ref:u,class:"p-5 w-full max-w-[500px] mx-auto mt-3","label-width":"120px"},{default:r(()=>[s(o,{label:"帳號",prop:"email"},{default:r(()=>[s(y,{modelValue:_.email,"onUpdate:modelValue":t[0]||(t[0]=E=>_.email=E),placeholder:"請輸入email做為您的帳號"},null,8,["modelValue"])]),_:1}),s(o,{label:"密碼",prop:"password"},{default:r(()=>[s(y,{modelValue:_.password,"onUpdate:modelValue":t[1]||(t[1]=E=>_.password=E),type:"password","show-password":"",placeholder:"密碼需8-12位，需有英文大小寫及數字"},null,8,["modelValue"])]),_:1}),s(o,{label:"再次輸入密碼",prop:"confirmPassword"},{default:r(()=>[s(y,{modelValue:_.confirmPassword,"onUpdate:modelValue":t[2]||(t[2]=E=>_.confirmPassword=E),type:"password","show-password":"",placeholder:"請輸入相同的密碼"},null,8,["modelValue"])]),_:1}),s(o,{label:"會員姓名",prop:"name"},{default:r(()=>[s(y,{modelValue:_.name,"onUpdate:modelValue":t[3]||(t[3]=E=>_.name=E),placeholder:"請輸入真實姓名(如:王曉明)"},null,8,["modelValue"])]),_:1}),s(o,{label:"生日",prop:"birthday"},{default:r(()=>[s(x,{modelValue:_.birthday,"onUpdate:modelValue":t[4]||(t[4]=E=>_.birthday=E),type:"date",placeholder:"請選擇生日",format:"YYYY/MM/DD","value-format":"YYYY/MM/DD","disabled-date":E=>E.getTime()>Date.now()},null,8,["modelValue","disabled-date"])]),_:1}),s(o,{label:"手機號碼",prop:"phone"},{default:r(()=>[s(y,{modelValue:_.phone,"onUpdate:modelValue":t[5]||(t[5]=E=>_.phone=E),type:"tel",maxlength:"11",placeholder:"請輸入手機號碼，如0900123456",onBlur:g},null,8,["modelValue"])]),_:1}),s(o,{label:"驗證碼",prop:"captcha"},{default:r(()=>[e("div",lo,[s(y,{modelValue:_.captcha,"onUpdate:modelValue":t[6]||(t[6]=E=>_.captcha=E),placeholder:"請輸入4位數字驗證碼",class:"w-full sm:w-[180px]"},null,8,["modelValue"]),e("div",ao,v(a.value),1),s(I,{onClick:i,link:"",type:"primary"},{default:r(()=>t[7]||(t[7]=[h("重新產生")])),_:1,__:[7]})])]),_:1})]),_:1},8,["model"]),s(I,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:D},{default:r(()=>t[8]||(t[8]=[h("註冊")])),_:1,__:[8]})])])}}},no=(f,u)=>{const a=f.__vccOpts||f;for(const[l,p]of u)a[l]=p;return a},io={class:"sticky top-0 bg-white p-2 pt-0 z-10 border-b"},uo={class:"text-center"},co={class:"center-xy mt-2"},mo={class:"overflow-y-auto md:px-4 pt-4",style:{"max-height":"calc(100vh - 160px)"}},po={key:0,class:"text-center"},fo={key:1,class:"space-y-4"},vo={class:"center-x items-start"},_o={class:"flex-1"},go={class:"font-bold"},xo={class:"text-sm text-gray-500 mt-1"},bo={class:"w-8"},wo={class:"text-red-500 w-10 text-right"},yo={class:"flex flex-col gap-2 items-end"},ho={class:"absolute bottom-0 left-0 right-0 bg-white p-4 border-t z-10"},ko={class:"center-y justify-between mb-4 mx-2"},$o={class:"text-xl font-bold"},Io={class:"flex gap-4"},Vo={__name:"CartDrawer",emits:["edit-item"],setup(f,{emit:u}){const a=he(),l=ae(),p=C(window.innerWidth<768),_=u,P=()=>{p.value=window.innerWidth<768},g=D=>{_("edit-item",D),a.showCart=!1},i=()=>{if(a.cartItems.length===0){S.warning("購物車是空的");return}a.showCart=!1,l.push("/checkout")};return ce(()=>{window.addEventListener("resize",P)}),Be(()=>{window.removeEventListener("resize",P)}),(D,c)=>{const t=me,y=X,o=Ue;return n(),W(o,{modelValue:$(a).showCart,"onUpdate:modelValue":c[1]||(c[1]=x=>$(a).showCart=x),size:p.value?"100%":"40%",direction:"rtl",class:"!p-0 !m-0 overflow-hidden","with-header":!1},{default:r(()=>[e("div",io,[e("div",uo,[c[2]||(c[2]=e("div",{class:"text-lg font-bold"},"購物車",-1)),e("div",co,[e("div",null,"你選擇了 "+v($(a).cartCount)+" 項商品",1)])])]),e("div",mo,[$(a).cartItems.length===0?(n(),m("div",po,"購物車是空的")):(n(),m("div",fo,[(n(!0),m(L,null,H($(a).cartItems,x=>(n(),m("div",{key:x.cartId,class:"border-b pb-4"},[e("div",vo,[e("div",_o,[e("div",go,v(x.name),1),e("div",xo,[(n(!0),m(L,null,H(x.extras,(I,Y)=>(n(),m("span",{key:I.id},[h(v(I.name)+": ",1),(n(!0),m(L,null,H(I.options,(E,q)=>(n(),m("span",{key:E.id},[h(v(E.name)+" ",1),I.type==="add-on"?(n(),m(L,{key:0},[h(" x"+v(E.quantity)+"（每份都加） ",1)],64)):N("",!0),q<I.options.length-1?(n(),m(L,{key:1},[h(", ")],64)):N("",!0)]))),128)),Y<x.extras.length-1?(n(),m(L,{key:0},[h(" | ")],64)):N("",!0)]))),128))])]),e("div",bo,v(x.quantity)+"個",1),e("div",wo,"$"+v($(a).getItemTotal(x)),1),e("div",yo,[s(y,{circle:"",size:"small",class:"hover:bg-gray-100",onClick:I=>g(x)},{default:r(()=>[s(t,null,{default:r(()=>[s($(it))]),_:1})]),_:2},1032,["onClick"]),s(y,{circle:"",size:"small",class:"hover:bg-gray-100",onClick:I=>$(a).removeFromCart(x.cartId)},{default:r(()=>[s(t,null,{default:r(()=>[s($(dt))]),_:1})]),_:2},1032,["onClick"])])])]))),128))]))]),e("div",ho,[e("div",ko,[c[3]||(c[3]=e("div",{class:"text-lg"},"小計",-1)),e("div",$o,"NTD $"+v($(a).totalPrice),1)]),e("div",Io,[s(y,{type:"info",class:"flex-1",onClick:c[0]||(c[0]=x=>$(a).showCart=!1)},{default:r(()=>c[4]||(c[4]=[h("繼續購物")])),_:1,__:[4]}),s(y,{type:"primary",class:"flex-1",onClick:i},{default:r(()=>c[5]||(c[5]=[h("確認結帳")])),_:1,__:[5]})])])]),_:1},8,["modelValue","size"])}}},Co=no(Vo,[["__scopeId","data-v-922b5852"]]),Po={class:"w-[90%] mx-auto mb-4 lg:w-[80%]"},To={class:"w-full lg:w-[90%] mx-auto min-h-[300px] relative"},So={key:1,class:"grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 justify-items-center"},Do={class:"h-[200px] w-full overflow-hidden"},Oo=["src","alt"],qo={class:"text-xl font-semibold pt-2"},Eo={class:"text-red-500"},Mo=["onClick"],Uo={key:0,class:"text-center text-gray-400 py-10 text-lg"},Lo={key:0,class:"absolute -top-1 -right-0 h-5 w-5 rounded-full bg-red-600 text-white center-xy text-sm"},zo={class:"h-[220px] w-full overflow-hidden bg-gray-100 center-xy"},Ao=["src","alt"],No={class:"text-xl font-bold py-3"},Ro={class:"text-red-800 ml-4 text-lg"},Yo={key:0},Ho={class:"flex flex-wrap gap-3"},jo={class:"py-2"},Bo={key:1},Fo={class:"font-bold"},Jo={key:2},Wo={class:"font-bold"},Zo={class:"center-xy py-3 gap-3 flex-col sm:flex-row"},Go={class:"absolute right-2"},Ko={__name:"Product",setup(f){const u=he(),a=C(0),l=C(""),p=C([]),_=C([]),P=C([]),g=C(!0),i=G(()=>a.value===0?_.value:_.value.filter(T=>T.cateId===a.value)),D=G(()=>l.value?_.value.filter(T=>T.name.toLowerCase().includes(l.value.toLowerCase())):[]),c=G(()=>l.value?D.value:i.value),t=C({name:"",price:0,quantity:1,extraType:[],extras:[]}),y=C([]),o=C([]),x=C([]),I=T=>{var U,M;R("toggleProductDia 被調用，傳入商品:",T),u.editingItem?(R("從購物車編輯模式，editingItem:",u.editingItem),t.value={...u.editingItem},R("設置後的selectedProduct:",t.value),y.value=(U=u.editingItem.extraType)!=null&&U.length?P.value.filter(k=>u.editingItem.extraType.includes(k.id)):[],o.value=u.editingItem.extras||[],x.value=u.editingItem.extras.filter(k=>k.type==="condiments").flatMap(k=>k.options.map(z=>z.name)),R("編輯模式下的初始化狀態:",{selectedProduct:t.value,hasExtras:y.value,selectedExtra:o.value,selectedCondiments:x.value})):(R("新增商品模式，product:",T),t.value={...T,quantity:1},y.value=(M=T.extraType)!=null&&M.length?P.value.filter(k=>T.extraType.includes(k.id)):[],o.value=[],x.value=[],R("新增模式下的初始化狀態:",{selectedProduct:t.value,hasExtras:y.value,selectedExtra:o.value,selectedCondiments:x.value})),y.value.forEach(k=>{var z;if(["single-choice","size","tempture"].includes(k.type)){const F=(z=o.value.find(K=>K.type===k.type))==null?void 0:z.options[0];w.value[k.type]=(F==null?void 0:F.name)||k.options[0].name,F||Y(k,k.options[0])}}),R("設置單選加料後的狀態:",{singleSelected:w.value,selectedExtra:o.value}),u.showProduct=!0},Y=(T,U)=>{const M=o.value.findIndex(k=>k.type===T.type);M===-1?o.value.push({id:T.id,name:T.name,type:T.type,options:[{...U,quantity:1}].sort((k,z)=>k.id-z.id)}):o.value[M].options=[{...U,quantity:1}].sort((k,z)=>k.id-z.id),o.value.sort((k,z)=>k.id-z.id),o.value=[...o.value]},E=(T,U)=>{const M=o.value.findIndex(k=>k.id===T.id);if(M===-1)o.value.push({id:T.id,name:T.name,type:T.type,options:[{...U,quantity:1}].sort((k,z)=>k.id-z.id)});else{const k=o.value[M].options,z=k.findIndex(F=>F.id===U.id);z===-1?k.push({...U,quantity:1}):(T.type==="condiments"||k[z].quantity===0)&&(k[z].quantity=1),k.sort((F,K)=>F.id-K.id)}o.value.sort((k,z)=>k.id-z.id),o.value=[...o.value]};oe(x,T=>{y.value.filter(M=>M.type==="condiments").forEach(M=>{const k=o.value.findIndex(F=>F.id===M.id),z=M.options.filter(F=>T.includes(F.name)).map(F=>({...F,quantity:1})).sort((F,K)=>F.id-K.id);k===-1?z.length>0&&o.value.push({id:M.id,name:M.name,type:M.type,options:z}):z.length>0?o.value[k].options=z:o.value.splice(k,1)}),o.value.sort((M,k)=>M.id-k.id),o.value=[...o.value]},{deep:!0});const q=T=>{switch(T){case"single-choice":return"麵包選擇";case"size":return"尺寸";case"tempture":return"溫度";default:return"必選"}},w=C({size:"",tempture:"","single-choice":""}),Z=G(()=>{const T=o.value.map(M=>({...M,options:M.options.filter(k=>k.quantity>0)})).filter(M=>M.options.length>0),U={...t.value,extras:T};return u.getItemTotal(U)}),B=()=>{const T={...t.value,cartId:t.value.cartId||crypto.randomUUID(),extraType:t.value.extraType||[]},U=(o.value||[]).map(M=>({...M,options:M.options.filter(k=>k.quantity>0).sort((k,z)=>k.id-z.id)})).filter(M=>M.options.length>0).sort((M,k)=>M.id-k.id);u.addToCart(T,U),u.showProduct=!1,u.clearEditingItem(),t.value={name:"",price:0,quantity:1,extraType:[],extras:[]},o.value=[],x.value=[],y.value=[],w.value={size:"",tempture:"","single-choice":""}};oe(o,T=>{R("選擇的加料更新了:",T)},{deep:!0});const pe=T=>{u.setEditingItem(T),I(T)};oe(()=>u.showProduct,T=>{T&&u.editingItem&&(R("商品彈窗打開，初始化編輯商品:",u.editingItem),Pe(()=>{I(u.editingItem)}))});const fe=async()=>{try{const T=await wt();T&&T.data&&(p.value=T.data.categories||[],_.value=T.data.products||[],P.value=T.data.extras||[])}catch(T){R("獲取菜單失敗:",T)}};return ce(async()=>{g.value=!0,await fe(),g.value=!1}),oe(a,()=>{l.value=""}),(T,U)=>{const M=ct,k=ut,z=me,F=re,K=mt,ge=X,xe=pt,ke=ze,$e=Le,Ie=vt,A=ft,d=we;return n(),m(L,null,[s(k,{modelValue:a.value,"onUpdate:modelValue":U[0]||(U[0]=b=>a.value=b),class:"px-4"},{default:r(()=>[(n(!0),m(L,null,H(p.value,b=>(n(),W(M,{key:b.id,label:b.name,name:b.id},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),e("div",Po,[s(F,{modelValue:l.value,"onUpdate:modelValue":U[1]||(U[1]=b=>l.value=b),placeholder:"搜尋商品"},{prefix:r(()=>[s(z,null,{default:r(()=>[s($(Fe))]),_:1})]),_:1},8,["modelValue"])]),e("div",To,[g.value?(n(),W(ts,{key:0})):N("",!0),c.value.length>0?(n(),m("div",So,[(n(!0),m(L,null,H(c.value,b=>(n(),W(K,{key:b.id,class:"h-[300px] w-[260px] mb-5 relative"},{default:r(()=>[e("div",Do,[e("img",{src:`/breakfast-frontend/images/${b.image}.jpg`,alt:b.name,loading:"lazy",class:"w-full h-full object-cover object-center"},null,8,Oo)]),e("div",qo,v(b.name),1),e("div",Eo,"$"+v(b.price),1),e("div",{class:"h-8 w-8 rounded-full center-xy bg-slate-200 absolute right-5 bottom-5 cursor-pointer hover:bg-orange-100",onClick:j=>I(b)},[s(z,null,{default:r(()=>[s($(Oe))]),_:1})],8,Mo)]),_:2},1024))),128))])):(n(),m(L,{key:2},[l.value?(n(),m("div",Uo,"查無此商品")):N("",!0)],64))]),e("div",{class:"fixed bottom-[80px] lg:top-[200px] right-3 h-10 w-10 center-xy rounded-full bg-orange-400 text-white border border-white",onClick:U[2]||(U[2]=(...b)=>$(u).toggleCart&&$(u).toggleCart(...b))},[$(u).cartItems.length>0?(n(),m("div",Lo,v($(u).cartItems.length),1)):N("",!0),s(z,null,{default:r(()=>[s($(Oe))]),_:1})]),s(d,{modelValue:$(u).showProduct,"onUpdate:modelValue":U[5]||(U[5]=b=>$(u).showProduct=b),class:"!w-full md:!w-[80%] lg:!w-[60%]"},{default:r(()=>[s(K,{class:"!h-full overflow-y-auto md:p-2 2xl:px-6"},{default:r(()=>[e("div",zo,[e("img",{src:`/breakfast-frontend/images/${t.value.image}.jpg`,alt:t.value.name,loading:"lazy",class:"max-w-full max-h-full object-contain"},null,8,Ao)]),e("div",No,[h(v(t.value.name)+" ",1),e("span",Ro,"$"+v(t.value.price),1)]),(n(!0),m(L,null,H(y.value,b=>{var j;return n(),m("div",{key:b.id},[b.type==="add-on"?(n(),m("div",Yo,[e("div",Ho,[(n(!0),m(L,null,H(b.options,V=>(n(),W(ge,{key:V.id,onClick:J=>E(b,V),class:"!w-[120px] !m-0"},{default:r(()=>[e("div",null,v(V.name),1),e("div",null,"$"+v(V.price),1)]),_:2},1032,["onClick"]))),128))]),e("div",jo,[U[6]||(U[6]=e("div",{class:"font-bold"},"加料區",-1)),(n(!0),m(L,null,H(((j=o.value.find(V=>V.id===b.id))==null?void 0:j.options)||[],V=>(n(),m("div",{key:V.id,class:"center-y gap-2 py-1"},[V.quantity>0?(n(),m(L,{key:0},[s(xe,{modelValue:V.quantity,"onUpdate:modelValue":J=>V.quantity=J,min:0,max:3,class:"h-5 w-[140px] sm:w-[160px]"},null,8,["modelValue","onUpdate:modelValue"]),e("div",null,v(V.name),1),e("div",null,"共$"+v(V.price*V.quantity),1)],64)):N("",!0)]))),128))])])):N("",!0),["single-choice","size","tempture"].includes(b.type)?(n(),m("div",Bo,[e("div",Fo,v(q(b.type)),1),s($e,{modelValue:w.value[b.type],"onUpdate:modelValue":V=>w.value[b.type]=V},{default:r(()=>[(n(!0),m(L,null,H(b.options,V=>(n(),W(ke,{key:V.id,value:V.name,onClick:J=>Y(b,V)},{default:r(()=>[h(v(V.name)+" +$"+v(V.price),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):N("",!0),b.type==="condiments"?(n(),m("div",Jo,[e("div",Wo,v(b.name),1),s(A,{modelValue:x.value,"onUpdate:modelValue":U[3]||(U[3]=V=>x.value=V)},{default:r(()=>[(n(!0),m(L,null,H(b.options,V=>(n(),W(Ie,{key:V.id,label:V.name,onClick:J=>E(b,V)},{default:r(()=>[h(v(V.name),1)]),_:2},1032,["label","onClick"]))),128))]),_:2},1032,["modelValue"])])):N("",!0)])}),128)),e("div",Zo,[t.value.quantity?(n(),W(xe,{key:0,modelValue:t.value.quantity,"onUpdate:modelValue":U[4]||(U[4]=b=>t.value.quantity=b),min:1,class:"w-[150px]"},null,8,["modelValue"])):N("",!0),s(ge,{class:"w-[230px] sm:flex-1 rounded-md text-white text-lg font-semibold relative",type:"primary",onClick:B},{default:r(()=>[U[7]||(U[7]=h("加入購物車 ")),e("span",Go,"+$"+v(Z.value),1)]),_:1,__:[7]})])]),_:1})]),_:1},8,["modelValue"]),s(Co,{onEditItem:pe})],64)}}},Qo={class:"p-5 px-10 max-w-7xl mx-auto"},Xo={class:"flex flex-col md:flex-row gap-5 mb-6"},el={class:"mt-6 center-xy"},tl={class:"mx-auto w-full text-center"},sl={key:0,class:"p-3 md:p-5"},ol={class:"flex items-center mb-4"},ll={class:"flex items-center mb-4"},al={class:"flex items-center mb-4"},rl={class:"flex items-center mb-4"},nl={class:"flex items-center mb-4"},il={key:0,class:"flex items-center mb-4"},dl={key:1,class:"flex items-center mb-4"},ul={class:"flex items-center mb-4"},cl={class:"flex items-center mb-4"},ml={class:"mt-6"},pl={class:"center-xy py-1"},fl={class:"w-1/2 text-lg"},vl={class:"w-1/4 text-center"},_l={class:"w-1/4 text-right pr-2"},gl={key:0},xl={class:"w-1/2 pl-4"},bl={class:"w-1/4 text-center"},wl={class:"w-1/4 text-right pr-2"},yl={class:"mt-6 text-right"},hl={class:"text-xl text-red-500 font-bold ml-2"},kl={__name:"History",setup(f){const u=Te(),a=C(""),l=C([]),p=C(!1),_=C(null),P=c=>c?new Date(c).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",g=G(()=>{let c=u.historyOrders;if(a.value&&(c=c.filter(t=>t.orderId.toLowerCase().includes(a.value.toLowerCase()))),l.value&&l.value.length===2){const[t,y]=l.value;c=c.filter(o=>{const x=new Date(o.timestamp);return x>=new Date(t)&&x<=new Date(y+" 23:59:59")})}return c}),i=c=>{console.log("訂單詳情:",{orderId:c.orderId,pickupType:c.pickupType,takeTime:c.takeTime,timestamp:c.timestamp}),_.value=c,p.value=!0},D=()=>{};return ce(async()=>{await u.init()}),(c,t)=>{const y=me,o=re,x=ye,I=xt,Y=X,E=_t,q=we;return n(),m("div",Qo,[t[16]||(t[16]=e("h2",{class:"text-2xl font-bold mb-6"},"訂單歷史記錄",-1)),e("div",Xo,[s(o,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=w=>a.value=w),placeholder:"請輸入訂單編號",class:"!w-full md:!w-[250px]",clearable:"",onClear:D},{prefix:r(()=>[s(y,null,{default:r(()=>[s($(gt))]),_:1})]),_:1},8,["modelValue"]),s(x,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=w=>l.value=w),type:"daterange","range-separator":"至","start-placeholder":"開始日期","end-placeholder":"結束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"!w-full md:!w-[200px]",onChange:c.search},null,8,["modelValue","onChange"])]),e("div",el,[e("div",tl,[s(E,{data:g.value,style:{width:"100%"}},{default:r(()=>[s(I,{prop:"orderId",label:"訂單編號",width:"200"}),s(I,{prop:"timestamp",label:"訂單產生時間",width:"230"},{default:r(({row:w})=>[h(v(P(w.timestamp)),1)]),_:1}),s(I,{prop:"pickupType",label:"取餐方式",width:"120"},{default:r(({row:w})=>[h(v(w.pickupType==="dine-in"?"內用":"外帶"),1)]),_:1}),s(I,{prop:"totalPrice",label:"總金額",width:"80"},{default:r(({row:w})=>[h(" $"+v(w.totalPrice),1)]),_:1}),s(I,{prop:"takeTime",label:"取餐時間",width:"180"},{default:r(({row:w})=>[h(v(P(w.takeTime)),1)]),_:1}),s(I,{label:"訂單詳細",fixed:"right",class:"w-[110px]"},{default:r(({row:w})=>[s(Y,{type:"primary",link:"",onClick:Z=>i(w)},{default:r(()=>t[3]||(t[3]=[h(" 查看詳情 ")])),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),s(q,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=w=>p.value=w),title:"訂單詳情",class:"!w-full max-w-xl"},{default:r(()=>[_.value?(n(),m("div",sl,[e("div",ol,[t[4]||(t[4]=e("span",{class:"font-bold w-24"},"訂單編號：",-1)),e("span",null,v(_.value.orderId),1)]),e("div",ll,[t[5]||(t[5]=e("span",{class:"font-bold w-24"},"訂單產生時間：",-1)),e("span",null,v(P(_.value.timestamp)),1)]),e("div",al,[t[6]||(t[6]=e("span",{class:"font-bold w-24"},"訂購人：",-1)),e("span",null,v(_.value.customer.name),1)]),e("div",rl,[t[7]||(t[7]=e("span",{class:"font-bold w-24"},"電話：",-1)),e("span",null,v(_.value.customer.phone),1)]),e("div",nl,[t[8]||(t[8]=e("span",{class:"font-bold w-24"},"取餐方式：",-1)),e("span",null,v(_.value.pickupType==="dine-in"?"內用":"外帶"),1)]),_.value.pickupType==="dine-in"?(n(),m("div",il,[t[9]||(t[9]=e("span",{class:"font-bold w-24"},"桌號：",-1)),e("span",null,v(_.value.tableNumber),1)])):N("",!0),_.value.pickupType==="takeout"?(n(),m("div",dl,[t[10]||(t[10]=e("span",{class:"font-bold w-24"},"取餐時間：",-1)),e("span",null,v(_.value.takeTime?P(_.value.takeTime):"未設定"),1)])):N("",!0),e("div",ul,[t[11]||(t[11]=e("span",{class:"font-bold w-24"},"付款方式：",-1)),e("span",null,v(_.value.paymentMethod==="cash"?"現金":"信用卡"),1)]),e("div",cl,[t[12]||(t[12]=e("span",{class:"font-bold w-24"},"備註：",-1)),e("span",null,v(_.value.note||"無"),1)]),e("div",ml,[t[13]||(t[13]=e("h4",{class:"text-lg font-bold mb-4"},"訂購項目",-1)),t[14]||(t[14]=e("div",{class:"center-x border-b py-1 font-bold bg-gray-100 text-gray-400 text-center"},[e("div",{class:"w-1/2"},"商品名稱"),e("div",{class:"w-1/4"},"數量"),e("div",{class:"w-1/4 text-right pr-2"},"價格")],-1)),(n(!0),m(L,null,H(_.value.items,w=>(n(),m("div",{key:w.cartId,class:"border-b"},[e("div",pl,[e("div",fl,v(w.name),1),e("div",vl,v(w.quantity),1),e("div",_l,"$"+v(w.price*w.quantity),1)]),w.extras&&w.extras.length>0?(n(),m("div",gl,[(n(!0),m(L,null,H(w.extras,Z=>(n(),m("div",{key:Z.id},[(n(!0),m(L,null,H(Z.options,B=>(n(),m("div",{key:B.id,class:"center-xy w-full py-1"},[e("div",xl,v(B.name)+" ($"+v(B.price)+")",1),e("div",bl,v(B.quantity)+"(每份都加)",1),e("div",wl," $"+v(B.price*B.quantity*w.quantity),1)]))),128))]))),128))])):N("",!0)]))),128))]),e("div",yl,[t[15]||(t[15]=e("span",{class:"font-bold"},"總金額：",-1)),e("span",hl,"$"+v(_.value.totalPrice),1)])])):N("",!0)]),_:1},8,["modelValue"])])}}},$l={class:"mx-auto mt-10"},Il=Object.assign({name:"MemberView"},{__name:"Member",setup(f){return(u,a)=>{const l=Me("router-view");return n(),m("div",$l,[s(l)])}}}),Vl={class:"relative"},Cl={class:"border border-gray-300 w-[90%] mx-auto"},Pl={class:"text-gray-700"},Tl={key:0,class:"text-gray-700"},Sl=Object.assign({name:"MemberProfileView"},{__name:"MemberProfile",setup(f){const u=C(null),a=se(),l=ie({name:"",phone:"",birthday:""}),p={phone:[{required:!0,message:"請輸入電話",trigger:"blur"},{pattern:/^09\d{2}-\d{6}$/,message:"電話格式錯誤",trigger:"blur"}]},_=()=>{const g=l.phone.replace(/\D/g,"").slice(0,10);g.length>4?l.phone=g.slice(0,4)+"-"+g.slice(4):l.phone=g},P=async()=>{var g;try{if(!u.value)return;await u.value.validate();const i=await $t(a.userId,{phone:l.phone.replace(/-/g,""),birthday:l.birthday||null});i.code===0?(S.success("會員資料修改成功"),a.setUserInfo({...a.userInfo,phone:l.phone,birthday:l.birthday})):S.error(i.message||"會員資料修改失敗")}catch(i){if(i.response)switch(i.response.status){case 403:S.error("無權限修改");break;case 404:S.error("找不到用戶");break;default:S.error(((g=i.response.data)==null?void 0:g.message)||"會員資料修改失敗")}else S.error("請確認所有欄位正確");console.error("驗證失敗",i)}};return ce(()=>{l.name=a.userInfo.name,l.phone=a.userInfo.phone,l.birthday=a.userInfo.birthday}),(g,i)=>{const D=ue,c=re,t=ye,y=de,o=X;return n(),m("div",Vl,[i[3]||(i[3]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"修改會員資料",-1)),e("div",Cl,[s(y,{model:l,rules:p,ref_key:"formRef",ref:u,class:"p-5 w-full max-w-md mx-auto mt-3","label-width":"100px"},{default:r(()=>[s(D,{label:"姓名",class:"mx-auto max-w-xs"},{default:r(()=>[e("span",Pl,v(l.name),1)]),_:1}),s(D,{label:"手機",prop:"phone",class:"mx-auto max-w-xs"},{default:r(()=>[s(c,{modelValue:l.phone,"onUpdate:modelValue":i[0]||(i[0]=x=>l.phone=x),placeholder:"請輸入手機號碼",onBlur:_,maxlength:"11",class:"w-[150px]"},null,8,["modelValue"])]),_:1}),s(D,{label:"生日",prop:"birthday",class:"mx-auto max-w-xs"},{default:r(()=>[l.birthday?(n(),m("span",Tl,v(l.birthday),1)):(n(),W(t,{key:1,modelValue:l.birthday,"onUpdate:modelValue":i[1]||(i[1]=x=>l.birthday=x),type:"date",placeholder:"請選擇生日",format:"YYYY/MM/DD","value-format":"YYYY/MM/DD","disabled-date":x=>x.getTime()>Date.now()},null,8,["modelValue","disabled-date"]))]),_:1})]),_:1},8,["model"]),s(o,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:P},{default:r(()=>i[2]||(i[2]=[h("確認修改")])),_:1,__:[2]})])])}}}),Dl={class:"relative"},Ol={class:"border border-gray-300 w-[90%] mx-auto"},ql=Object.assign({name:"ChangePasswordView"},{__name:"ChangePassword",setup(f){const u=C(null),a=se(),l=ae(),p=ie({oldPassword:"",newPassword:"",confirmPassword:""}),_={oldPassword:[{required:!0,message:"請輸入舊密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請輸入確認密碼",trigger:"blur"},{validator:(g,i,D)=>{i!==p.newPassword?D(new Error("密碼不一致")):D()},trigger:"blur"}]},P=async()=>{var g;try{if(!u.value)return;await u.value.validate();const i=await Vt(a.userId,{oldPassword:p.oldPassword,newPassword:p.newPassword});i.code===0?(S.success("密碼修改成功"),l.push("/"),p.oldPassword="",p.newPassword="",p.confirmPassword=""):S.error(i.message||"密碼修改失敗")}catch(i){if(i.response)switch(i.response.status){case 403:S.error("無權限修改");break;case 404:S.error("找不到用戶");break;case 405:S.error("舊密碼錯誤");break;default:S.error(((g=i.response.data)==null?void 0:g.message)||"密碼修改失敗")}else S.error("請確認所有欄位正確");console.error("驗證失敗",i)}};return(g,i)=>{const D=re,c=ue,t=de,y=X;return n(),m("div",Dl,[i[4]||(i[4]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"修改密碼",-1)),e("div",Ol,[s(t,{model:p,rules:_,ref_key:"formRef",ref:u,class:"p-5 w-full max-w-xl mx-auto mt-3 space-y-8","label-width":"100px","label-position":"left"},{default:r(()=>[s(c,{label:"舊密碼",prop:"oldPassword"},{default:r(()=>[s(D,{modelValue:p.oldPassword,"onUpdate:modelValue":i[0]||(i[0]=o=>p.oldPassword=o),type:"password","show-password":"",placeholder:"請輸入舊密碼",class:"w-full max-w-[400px]"},null,8,["modelValue"])]),_:1}),s(c,{label:"新密碼",prop:"newPassword"},{default:r(()=>[s(D,{modelValue:p.newPassword,"onUpdate:modelValue":i[1]||(i[1]=o=>p.newPassword=o),type:"password","show-password":"",placeholder:"密碼需8-12位，需有英文大小寫及數字",class:"w-full max-w-[400px]"},null,8,["modelValue"])]),_:1}),s(c,{label:"確認新密碼",prop:"confirmPassword"},{default:r(()=>[s(D,{modelValue:p.confirmPassword,"onUpdate:modelValue":i[2]||(i[2]=o=>p.confirmPassword=o),type:"password","show-password":"",placeholder:"請輸入相同的新密碼",class:"w-full max-w-[400px]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(y,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:P},{default:r(()=>i[3]||(i[3]=[h("確認修改")])),_:1,__:[3]})])])}}}),El={class:"relative max-x-md mx-auto mt-10 center-x"},Ml={class:"border border-gray-300 w-[90%] mx-auto"},Ul={__name:"ForgotPassword",setup(f){const u=C(null),a=ae(),l=ie({email:""}),p={email:[{required:!0,message:"請輸入信箱",trigger:"blur"},{type:"email",message:"信箱格式錯誤",trigger:"blur"}]},_=async()=>{await u.value.validate();const P=await Ct({email:l.email}),g=P.token;P.code===0?(S.success("重設密碼連結已寄出，請至信箱查收（模擬）"),setTimeout(()=>{a.push(`/reset-password?token=${g}`)},2e3)):S.error(P.data.message||"發送失敗")};return(P,g)=>{const i=re,D=ue,c=de,t=X;return n(),m("div",El,[g[2]||(g[2]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"忘記密碼",-1)),e("div",Ml,[s(c,{model:l,rules:p,ref_key:"formRef",ref:u,class:"p-5 w-full max-w-[500px] mx-auto mt-3","label-width":"70px","label-position":"left"},{default:r(()=>[s(D,{label:"信箱",prop:"email",class:"mx-auto max-w-xs"},{default:r(()=>[s(i,{modelValue:l.email,"onUpdate:modelValue":g[0]||(g[0]=y=>l.email=y),placeholder:"請輸入註冊時的信箱",class:"w-full max-w-[250px]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(t,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:_},{default:r(()=>g[1]||(g[1]=[h("送出")])),_:1,__:[1]})])])}}},Ll={class:"relative max-x-md mx-auto mt-10 center-x"},zl={class:"border border-gray-300 w-[90%] mx-auto"},Al={__name:"ResetPassword",setup(f){const u=Ee(),a=ae(),l=C(null),p=ie({newPassword:"",confirmPassword:""}),_={newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,12}$/,message:"密碼需8-12位，含英文大小寫與數字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請輸入確認密碼",trigger:"blur"},{validator:(g,i,D)=>{i!==p.newPassword?D(new Error("密碼不一致")):D()},trigger:"blur"}]},P=async()=>{try{if(!l.value)return;await l.value.validate();const g=u.query.token,i=await Pt({token:g,newPassword:p.newPassword});i.code===0?(S.success("密碼重設成功，請重新登入"),a.push("/")):S.error(i.message||"密碼重設失敗")}catch(g){console.error("驗證失敗",g),S.error("密碼重設失敗")}};return(g,i)=>{const D=re,c=ue,t=de,y=X;return n(),m("div",Ll,[i[3]||(i[3]=e("div",{class:"absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-2"},"重設密碼",-1)),e("div",zl,[s(t,{model:p,rules:_,ref_key:"formRef",ref:l,class:"p-5 w-[70%] mx-auto mt-3","label-width":"120px"},{default:r(()=>[s(c,{label:"新密碼",prop:"newPassword"},{default:r(()=>[s(D,{modelValue:p.newPassword,"onUpdate:modelValue":i[0]||(i[0]=o=>p.newPassword=o),type:"password","show-password":"",placeholder:"密碼需8-12位，需有英文大小寫及數字"},null,8,["modelValue"])]),_:1}),s(c,{label:"確認新密碼",prop:"confirmPassword"},{default:r(()=>[s(D,{modelValue:p.confirmPassword,"onUpdate:modelValue":i[1]||(i[1]=o=>p.confirmPassword=o),type:"password","show-password":"",placeholder:"請輸入相同的新密碼"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(y,{class:"w-[200px] mx-auto block mb-5 !rounded-md",type:"primary",onClick:P},{default:r(()=>i[2]||(i[2]=[h("重設密碼")])),_:1,__:[2]})])])}}},Ae=Je({history:We("/breakfast-frontend/"),routes:[{path:"/",component:Xt,children:[{path:"",name:"home",component:ns},{path:"about",name:"about",component:us},{path:"checkout",name:"checkout",component:to},{path:"register",name:"register",component:ro},{path:"product",name:"product",component:Ko},{path:"history",name:"history",component:kl},{path:"forgot-password",name:"forgotPassword",component:Ul},{path:"reset-password",name:"resetPassword",component:Al},{path:"member",name:"member",component:Il,meta:{requiresAuth:!0},children:[{path:"",name:"memberProfile",component:Sl,meta:{requiresAuth:!0}},{path:"change-password",name:"changePassword",component:ql,meta:{requiresAuth:!0}}]}]}]});Ae.beforeEach((f,u,a)=>{const l=se();f.matched.some(p=>p.meta.requiresAuth)?l.isLoggedIn?a():a({path:"/",query:{redirect:f.fullPath}}):a()});const Se=Ze(Tt),Nl=Ke();Se.use(Nl);Se.use(Ae);Se.mount("#app");
